<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HillMusic</title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.loli.net/css2?family=Montserrat:wght@700&amp;family=Pacifico&amp;display=swap"
        rel="stylesheet">
    <!--   <script src="https://cdn.tailwindcss.com"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
    <script>
        webapp.circle(false);
        //ÂÖ≥Èó≠Âä†ËΩΩÊïàÊûútrueÊâìÂºÄ
        webapp.renew(false);
        //ÂÖ≥Èó≠‰∏ãÊãâÂà∑Êñ∞trueÊâìÂºÄ
        // ÂºÇÊ≠•Êõ¥Êñ∞Áä∂ÊÄÅÊ†èÈ¢úËâ≤
        const updateStatusBar = () => {
            // ‰ΩøÁî®setTimeoutÂ∞Ü‰ªªÂä°ÊîæÂÖ•‰∫ã‰ª∂Âæ™ÁéØÈòüÂàóÔºåÈÅøÂÖçÈòªÂ°û
            setTimeout(() => {
                try {
                    webapp.color(''); // Êõ¥Êñ∞È¢úËâ≤
                } catch (err) {
                    console.warn('Áä∂ÊÄÅÊ†èÊõ¥Êñ∞Â§±Ë¥•:', err);
                }
            }, 0); // Âª∂Ëøü0msÁ°Æ‰øùÂºÇÊ≠•ÊâßË°å
        };
        // ÊØ?000ÊØ´ÁßíËß¶Âèë‰∏ÄÊ¨?        const intervalId = setInterval(updateStatusBar, 3000);
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ÂèòÈáèÂÆö‰πâ */

        :root {
            --primary-color: #1db954;
            --primary-dark: #179c46;
            --text-color: #179c46;
            --bg-color: #fff;
            --secondary-bg: #f5f5f5;
            --border-color: #e0e0e0;
            --hover-color: #f8f8f8;
            --active-color: #e8e8e8;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --text-secondary: #666;
            --dark-color: #ffffff;
            --light-color: #ffffff;
            --gray-color: #b3b3b3;
            --light-gray: #f8f8f8;
            --dark-bg: #121212;
            --dark-card: #181818;
            --dark-text: #e0e0e0;
            --light-text: #2a2a2a;
        }

        /* Dark theme */

        body.dark-theme {
            --text-color: #fff;
            --bg-color: #121212;
            --secondary-bg: #282828;
            --border-color: #333;
            --hover-color: #333;
            --active-color: #404040;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --text-secondary: #b3b3b3;
        }

        /* Êé®ËçêÊ≠åÊõ≤Âå∫Ê†∑Âº?*/

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            #recommended-songs {
                grid-template-columns: 1fr;
            }
        }

        /* Ê∑ªÂä†ËÉåÊôØÂÆπÂô®Ê†∑Âºè */

        .music-bg-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            transition: background-image 0.5s ease;
        }

        .music-bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(50px) brightness(0.8);
            transform: scale(1.1);
            opacity: 0;
            transition: opacity 0.5s ease, filter 0.5s ease;
        }

        .music-bg-image.active {
            opacity: 1;
        }

        /* Á°Æ‰øùÂÜÖÂÆπÂú®ËÉåÊôØ‰∏äÂèØËØª */

        .container {
            border-radius: 12px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        body {
            font-family: "Montserrat", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--light-gray);
            color: #1db954;
            line-height: 1.6;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
        }

        body.dark-theme {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        body.dark-theme header {
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .logo {
            font-family: "Pacifico", cursive;
            font-size: 2.5rem;
            color: var(--text-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            display: inline-block;
        }

        body.dark-theme .logo {
            color: var(--dark-text);
        }

        .logo::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #1db954, #1ed760);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        .logo:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
        }

        .nav-tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            border-radius: 20px;
            transition: all 0.3s;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Icon tabs */

        .icon-tab {
            padding: 5px 5px;
            cursor: pointer;
            font-weight: 600;
            border-radius: 50%;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .search-container {
            display: flex;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 30px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0);
        }

        .search-container:focus-within {
            box-shadow: 0 2px 10px #179c46;
        }

        .search-input {
            flex: 1;
            padding: 15px 25px;
            border: none;
            font-size: 1rem;
            outline: none;
            font-family: "Montserrat", sans-serif;
            background: transparent;
            color: inherit;
        }

        .search-input::placeholder {
            color: var(--gray-color);
        }

        .search-btn {
            padding: 0 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            font-family: "Montserrat", sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-btn:hover {
            background-color: var(--primary-dark);
        }

        #search-page {
            display: block;
        }

        #player-page {
            display: none;
        }

        #local-music-page {
            display: none;
        }

        .song-list {
            background-color: rgba(255, 255, 255, 0);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 70px;
            display: column;
        }

        body.dark-theme .song-list {
            background-color: rgba(24, 24, 24, 0);
        }

        .song-item {
            display: flex;
            align-items: center;
            padding: 15px 30px 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            cursor: pointer;
        }

        body.dark-theme .song-item {
            border-bottom-color: rgba(255, 255, 255, 0.05);
        }

        .song-item:last-child {
            border-bottom: none;
        }

        .song-item:hover {
            background-color: rgba(29, 185, 84, 0.05);
        }

        body.dark-theme .song-item:hover {
            background-color: rgba(29, 185, 84, 0.1);
        }

        .song-item.active {
            background-color: rgba(29, 185, 84, 0.1);
        }

        body.dark-theme .song-item.active {
            background-color: rgba(29, 185, 84, 0.2);
        }

        .song-cover {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 20px;
            object-fit: cover;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .song-item:hover .song-cover {
            transform: scale(1.05);
        }

        .song-info {
            flex: 1;
            min-width: 0;
        }

        .song-title {
            font-weight: 600;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 1rem;
        }

        .song-artist {
            font-size: 0.85rem;
            color: var(--gray-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-number {
            width: 30px;
            text-align: center;
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-right: 15px;
            font-weight: 600;
        }

        .song-quality {
            margin-left: 15px;
            padding: 3px 8px;
            background: rgba(121, 160, 107, 0.212);
            color: var(--primary-color);
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .player-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 20px;
            position: relative;
            overflow: hidden;
        }

        .now-playing-cover {
            width: 280px;
            height: 280px;
            border-radius: 12px;
            object-fit: cover;
            margin-bottom: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            transition: all 0.5s;
        }

        .now-playing-info {
            text-align: center;
            margin-bottom: 10px;
            width: 100%;
        }

        .now-playing-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            cursor: pointer;
        }

        body.dark-theme .now-playing-title {
            color: var(--dark-text);
        }

        .now-playing-artist {
            font-size: 1.1rem;
            color: var(--gray-color);
            font-weight: 500;
        }

        .audio-player {
            width: 100%;
            max-width: 500px;
            margin-top: 60px;
            margin-bottom: 20px;
            border-radius: 50px;
            box-shadow: 0 5px 15px white;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .trending-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        body.dark-theme .trending-title {
            color: var(--dark-text);
        }

        .refresh-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            color: var(--primary-dark);
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: var(--gray-color);
            font-size: 1.1rem;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        body.dark-theme .result-title {
            color: var(--dark-text);
        }

        .refresh-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
            font: 1em sans-serif;
        }

        .refresh-btn:hover {
            color: var(--primary-dark);
        }

        .theme-icon-dark {
            color: var(--light-color);
        }

        .theme-icon-light {
            color: var(--primary-color);
        }

        /* Mini player styles */

        .mini-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 12px 12px 0 0;
            background-color: rgba(255, 255, 255, 0);
            -webkit-backdrop-filter: blur(100px);
            backdrop-filter: blur(100px);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            z-index: 1000;
        }

        .mini-player-cover {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: cover;
        }

        .mini-player-info {
            flex: 1;
            min-width: 0;
        }

        .mini-player-title {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.dark-theme .mini-player-title {
            color: var(--dark-text);
        }

        .mini-player-artist {
            font-size: 0.8rem;
            color: var(--gray-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .mini-player-controls {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-left: 15px;
        }

        .control-btn {
            background: none;
            border: none;
            color: var(--dark-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        body.dark-theme .control-btn {
            color: var(--dark-text);
        }

        .play-btn {
            background-color: var(--primary-color);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(29, 185, 84, 0.3);
        }

        .play-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }

        /* Player controls in player page */

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 25px;
            margin: 20px;
        }

        .player-control-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
            padding: 10px;
        }

        body.dark-theme .player-control-btn {
            color: var(--dark-text);
        }

        .player-play-btn {
            background-color: var(--primary-color);
            color: white;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(29, 185, 84, 0.3);
        }

        /* Player control buttons active state */

        .player-control-btn.active {
            color: var(--primary-color);
        }

        body.dark-theme .player-control-btn.active {
            color: var(--primary-color);
        }

        /* Lyrics page styles */

        .lyrics-container {
            display: none;
            width: 100%;
            height: calc(100vh - 190px);
            text-align: center;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }

        .lyrics-content {
            font-size: 1.1rem;
            line-height: 2;
            color: var(--primary-color);
            white-space: pre-line;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        body.dark-theme .lyrics-content {
            color: var(--dark-text);
        }

        .back-to-player {
            display: none;
            background: none;
            border: none;
            color: var(--primary-col);
            font-size: 1.1rem;
            cursor: pointer;
            z-index: 10;
            margin: 10px;
            margin-left: 30px;
        }

        body.dark-theme .back-to-player {
            color: var(--dark-text);
        }

        /* ÁÉ≠ÊêúÊ¶úÊ†∑Âº?*/

        .hot-search-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            padding: 10px 0;
            margin-bottom: 70px;
        }

        .hot-search-item {
            background: var(--secondary-bg);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            min-height: 100px;

        }

        /* Âè™‰∏∫Ââç‰∏âÂêçÊ∑ªÂä†Â∞ÅÈù¢ËÉåÊôØÂíåÊ∏êÂèòÈÅÆÁΩ© */

        .hot-search-item.top10 {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .hot-search-item.top10::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.8;
            z-index: 1;
        }

        /* ÈÅÆÁΩ©Â±ÇÊ†∑Âº?*/

        .hot-search-item.top10::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(29, 185, 84, 0.8), rgba(0, 0, 0, 0.5));
            z-index: 2;
        }

        /* Ââç‰∏âÂêçÁöÑÊñáÂ≠óÈúÄË¶ÅÂú®ÈÅÆÁΩ©Â±Ç‰πã‰∏?*/

        .hot-search-item.top10 .hot-search-rank,
        .hot-search-item.top10 .hot-search-content {
            position: relative;
            z-index: 3;
            color: #fff;
        }

        .hot-search-item.top10 .hot-search-title {
            color: #fff;
        }

        .hot-search-item.top10 .hot-search-desc {
            color: rgba(255, 255, 255, 0.8);
        }

        .hot-search-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .hot-search-rank {
            font-size: 1rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-right: 8px;
            min-width: 24px;
        }

        .hot-search-content {
            flex: 1;
        }

        .hot-search-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text-color);
        }

        .hot-search-desc {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .hot-search-item.top10 {
            background: linear-gradient(45deg, var(--primary-color), transparent);
        }

        .hot-search-item.top10 .hot-search-rank {
            color: #fff;
        }

        /* Ê≠åËØçÈ´ò‰∫ÆÊ†∑Âºè */

        .lyric-line {
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .lyric-line.active {
            color: var(--primary-color);
            font-weight: bold;
            transform: scale(1.05);
        }

        /* Ê≠åËØçÂÆπÂô®Âä®Áîª */

        .lyrics-container.show {
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        audio {
            width: 100%;
        }

        audio::-webkit-media-controls-panel {
            background-color: rgba(122, 245, 71, 0.545);
            border-radius: 0.5rem;
        }

        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-mute-button {
            background-color: #ffffff;
            border-radius: 50%;
            display: none;
        }

        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display {
            color: black;
            font-family: Sans-Serif;
        }

        .search-highlight {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .logo {
                font-size: 2rem;
            }

            .now-playing-cover {
                width: 220px;
                height: 220px;
            }

            .now-playing-title {
                font-size: 1.5rem;
            }

            .search-input {
                padding: 12px 20px;
            }

            .search-btn {
                padding: 0 20px;
            }

            .player-controls {
                gap: 30px;
            }

            .player-control-btn {
                font-size: 1.2rem;
            }

            .player-play-btn {
                width: 50px;
                height: 50px;
            }

            .lyrics-content {
                font-size: 1rem;
                line-height: 1.8;
                padding: 10px;
            }

            .section-title {
                font-size: 1.2rem;
            }

            .playlist-cover {
                height: 80px;
            }

            .recommended-song-cover {
                height: 100px;
            }
        }

        /* Âú®@mediaÊü•ËØ¢ÂâçÊ∑ªÂä?*/

        @media (min-width: 1024px) {
            .song-list {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .song-item {
                border-radius: 8px;
                margin-bottom: 0;
                border-bottom: none;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            }

            body.dark-theme .song-item {
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }
        }

        /* Home page styles */

        #home-page {
            display: none;
            padding: 20px 0;
        }

        .feature-buttons {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 0px;
            margin-bottom: 30px;
        }

        .feature-btn {
            background: transparent;
            border-radius: 0;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: var(--text-color);
        }

        .tab-music {
            grid-column: 1;
            grid-row: 1 / span 2;
            overflow: hidden;
        }

        #liked-music {
            grid-column: 2;
            grid-row: 1;
        }

        #local-music {
            grid-column: 2;
            grid-row: 2;
        }

        .section {
            padding: 10px;
        }

        body.dark-theme .section-title {
            color: var(--dark-text);
        }

        .playlist-grid {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            width: auto;
            margin-left: ;
        }

        .playlist-grid::-webkit-scrollbar {
            display: none;
            /* ÈöêËóèwebkitÊªöÂä®Êù?*/
        }

        .playlist-nav-dots {
            text-align: center;
        }

        .nav-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ccc;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-dot.active {
            background-color: var(--primary-color);
        }

        .playlist-item {
            border-radius: 12px;
            transition: all 0.3s;
            padding: 15px;
            position: relative;
            min-width: 120px;
        }

        .playlist-item:hover {
            transform: translateY(-5px);
        }

        .playlist-cover-container {
            position: relative;
            width: 100%;
            padding-bottom: 100%;
            margin-bottom: 15px;
        }

        .playlist-cover-stack {
            position: absolute;
            width: 80%;
            height: 80%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .playlist-cover-image {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .playlist-cover-image:nth-child(1) {
            transform: rotate(-5deg) translateX(-8%) translateY(-8%);
            z-index: 1;
        }

        .playlist-cover-image:nth-child(2) {
            transform: rotate(0deg);
            z-index: 2;
        }

        .playlist-cover-image:nth-child(3) {
            transform: rotate(5deg) translateX(8%) translateY(8%);
            z-index: 3;
        }

        .playlist-item:hover .playlist-cover-image:nth-child(1) {
            transform: rotate(-8deg) translateX(-12%) translateY(-12%);
        }

        .playlist-item:hover .playlist-cover-image:nth-child(3) {
            transform: rotate(8deg) translateX(12%) translateY(12%);
        }

        /* Ê≠åÂçïËØ¶ÊÉÖÈ°µÊ†∑Âº?*/

        .playlist-detail-page {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .playlist-detail-header {
            position: relative;
            display: flex;
            align-items: flex-start;
            gap: 30px;
            margin-bottom: 40px;
            padding: 30px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }

        .playlist-detail-cover {
            width: 200px;
            height: 200px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .playlist-detail-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .playlist-detail-cover:hover img {
            transform: scale(1.05);
        }

        .playlist-detail-info {
            flex: 1;
        }

        .playlist-detail-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--text-color);
        }

        .playlist-detail-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .playlist-detail-stats {
            display: flex;
            gap: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .playlist-songs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 10px;
        }

        .playlist-songs-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-color);
        }

        .play-all-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 14px 14px;
            color: var(--primary-color);
            border: none;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-all-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Âä†ËΩΩÁä∂ÊÄ?*/

        .loading {
            padding: 20px;
            text-align: center;
        }

        .batch-loader {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 1);
            border-top-color: var(--primary-dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 5px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Á©∫Áä∂ÊÄ?ÈîôËØØÁä∂ÊÄ?*/

        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
        }

        .empty-state .icon-error {
            font-size: 40px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.5);
        }

        .retry-btn {
            margin-top: 15px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ?*/

        @media (max-width: 768px) {
            .playlist-detail-header {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 20px;
            }

            .playlist-detail-cover {
                width: 150px;
                height: 150px;
            }

            .playlist-detail-title {
                font-size: 24px;
            }

            .playlist-detail-stats {
                justify-content: center;
            }
        }

        .back-to-home {
            position: absolute;
            top: -30px;
            left: 5px;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 10px;
            z-index: 10;
            transition: transform 0.3s ease;
        }

        .back-to-home:hover {
            transform: translateX(-3px);
        }

        body.dark-theme .back-to-home {
            color: var(--dark-text);
        }

        .tab-music {
            /* Ê∞îÊ≥°ÊïàÊûúÂúÜÂºß */
            border-top-left-radius: 10% 10%;
            border-bottom-left-radius: 10% 10%;
            border-top-right-radius: 0px;
            border-bottom-right-radius: 0px;
            /* Ê∞îÊ≥°Âä®ÁîªÊïàÊûú */
            animation: bubbleAnimation 16s infinite ease-in-out;
            animation-play-state: paused;
        }

        .search-tab {
            /* Ê∞îÊ≥°ÊïàÊûúÂúÜÂºß */
            border-top-right-radius: 10% 10%;
            /* Ê∞îÊ≥°Âä®ÁîªÊïàÊûú */
            animation: searchBubbleAnimation 12s infinite ease-in-out;
            animation-play-state: paused;
        }

        .local-tab {
            /* Ê∞îÊ≥°ÊïàÊûúÂúÜÂºß */
            border-bottom-right-radius: 10% 10%;
            /* Ê∞îÊ≥°Âä®ÁîªÊïàÊûú */
            animation: localBubbleAnimation 12s infinite ease-in-out;
            animation-play-state: paused;
        }

        /* Ê∞îÊ≥°ÂΩ¢ÊÄÅÂèòÂåñÁöÑÂÖ≥ÈîÆÂ∏ßÂä®Áî?*/

        @keyframes bubbleAnimation {
            0% {
                border-top-left-radius: 10% 10%;
                border-bottom-left-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(170, 220, 255, 0.8);
            }

            10% {
                border-top-left-radius: 40% 30%;
                border-bottom-left-radius: 30% 40%;
                transform: scale(1.002);
            }

            20% {
                border-top-left-radius: 60% 40%;
                border-bottom-left-radius: 45% 60%;
                transform: scale(1.006);
                background: rgba(150, 210, 250, 0.85);
            }

            30% {
                border-top-left-radius: 50% 70%;
                border-bottom-left-radius: 60% 50%;
                transform: scale(1.008);
            }

            40% {
                border-top-left-radius: 35% 75%;
                border-bottom-left-radius: 45% 35%;
                transform: scale(1.01);
                opacity: 1;
            }

            50% {
                border-top-left-radius: 25% 50%;
                border-bottom-left-radius: 35% 25%;
                transform: scale(1.007);
                background: rgba(180, 230, 255, 0.9);
            }

            60% {
                border-top-left-radius: 40% 35%;
                border-bottom-left-radius: 45% 40%;
                transform: scale(1.003);
            }

            70% {
                border-top-left-radius: 55% 65%;
                border-bottom-left-radius: 65% 55%;
                transform: scale(0.999);
            }

            80% {
                border-top-left-radius: 35% 60%;
                border-bottom-left-radius: 60% 35%;
                transform: scale(0.997);
                background: rgba(160, 215, 245, 0.87);
            }

            90% {
                border-top-left-radius: 20% 25%;
                border-bottom-left-radius: 25% 20%;
                transform: scale(0.998);
            }

            100% {
                border-top-left-radius: 10% 10%;
                border-bottom-left-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(170, 220, 255, 0.8);
            }
        }

        /* ÊêúÁ¥¢ÊåâÈíÆÁöÑÂä®ÁîªÂÖ≥ÈîÆÂ∏ß */

        @keyframes searchBubbleAnimation {
            0% {
                border-top-right-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(255, 215, 212, 0.8);
            }

            25% {
                border-top-right-radius: 40% 60%;
                transform: scale(1);
                background: rgba(255, 200, 195, 0.85);
            }

            50% {
                border-top-right-radius: 60% 40%;
                transform: scale(1);
                background: rgba(255, 185, 180, 0.9);
            }

            75% {
                border-top-right-radius: 30% 70%;
                transform: scale(1);
                background: rgba(255, 170, 165, 0.85);
            }

            100% {
                border-top-right-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(255, 215, 212, 0.8);
            }
        }

        /* Êú¨Âú∞Èü≥‰πêÊåâÈíÆÁöÑÂä®ÁîªÂÖ≥ÈîÆÂ∏ß */

        @keyframes localBubbleAnimation {
            0% {
                border-bottom-right-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(251, 229, 149, 0.8);
            }

            25% {
                border-bottom-right-radius: 40% 60%;
                transform: scale(1);
                background: rgba(251, 229, 149, 0.85);
            }

            50% {
                border-bottom-right-radius: 60% 40%;
                transform: scale(1);
                background: rgba(251, 229, 149, 0.9);
            }

            75% {
                border-bottom-right-radius: 30% 70%;
                transform: scale(1);
                background: rgba(251, 229, 149, 0.85);
            }

            100% {
                border-bottom-right-radius: 10% 10%;
                transform: scale(1);
                opacity: 0.95;
                background: rgba(251, 229, 149, 0.8);
            }
        }

        /* tab-playerÁöÑÊ†∑Âº?*/

        .tab-bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(5px) brightness(0.8);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .tab-bg-image.active {
            opacity: 1;
        }

        .tab-info {
            position: relative;
            z-index: 2;
            color: white;
            text-align: center;
        }

        .tab-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-info p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .tab-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .tab-control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .tab-play-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ÂπøÂëäÊ®°Âºè - ÈöêËóèÊéß‰ª∂ÂíåÊñáÂ≠?*/

        .ad-mode .tab-info,
        .ad-mode .tab-controls {
            opacity: 0.8;
            pointer-events: none;
            transform: translateY(10px);
        }

        .ad-mode .tab-bg-image {
            filter: none !important;
        }

        /* Êí≠ÊîæÊ®°Âºè - ÊòæÁ§∫Êéß‰ª∂ÂíåÊñáÂ≠?*/

        .playing-mode .tab-info,
        .playing-mode .tab-controls {
            opacity: 1;
            pointer-events: all;
            transform: translateY(0);
        }

        .playing-mode .tab-bg-image {
            filter: blur(5px) brightness(0.8);
        }

        /* Êñ∞Â¢ûÊ†∑Âºè */

        .hot-search-item.top10::before {
            background-image: var(--bg-image);
            transition: transform 0.3s ease;
        }

        .hot-search-item.top10:hover::before {
            transform: scale(1.1);
        }

        /* Ê∑ªÂä†Âà∞Áé∞ÊúâÊ†∑ÂºèË°®‰∏?*/

        #play-mode-btn {
            position: relative;
        }

        #play-mode-btn::after {
            content: attr(data-mode);
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        #download-btn {
            transition: all 0.3s ease;
        }

        #download-btn.downloading {
            animation: downloading 1s infinite linear;
        }

        @keyframes downloading {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-2px);
            }

            100% {
                transform: translateY(0);
            }
        }

        /* Ê∑ªÂä†Âà∞Áé∞ÊúâÊ†∑ÂºèË°®‰∏?*/

        .chart-nav {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }

        .chart-nav-btn {
            background: none;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            color: var(--text-color);
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .chart-nav-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* ‰∏∫‰∏çÂêåÊ¶úÂçïËÆæÁΩÆ‰∏çÂêåÁöÑÈÅÆÁΩ©È¢úËâ≤ */

        .hot-search-item.top10.chart-1::after {
            background: linear-gradient(45deg, rgba(29, 185, 84, 0.8), rgba(0, 0, 0, 0.5));
        }

        .hot-search-item.top10.chart-2::after {
            background: linear-gradient(45deg, rgba(255, 89, 89, 0.8), rgba(0, 0, 0, 0.5));
        }

        .hot-search-item.top10.chart-3::after {
            background: linear-gradient(45deg, rgba(64, 156, 255, 0.8), rgba(0, 0, 0, 0.5));
        }

        .hot-search-item.top10.chart-4::after {
            background: linear-gradient(45deg, rgba(250, 173, 20, 0.8), rgba(0, 0, 0, 0.5));
        }
    </style>
    <style>
        /* Ê∑ªÂä†Êâ´ÊèèËøõÂ∫¶Êù°Ê†∑Âº?*/

        .scan-progress {
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .progress-container {
            width: 100%;
            background-color: rgba(29, 185, 84, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 6px;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.85rem;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .stats span {
            display: inline-flex;
            align-items: center;
        }

        .stats i {
            margin-right: 5px;
            color: var(--primary-color);
        }

        .scan-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .scan-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(29, 185, 84, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .scan-btn {
            transition: all 0.3s ease;
        }

        .scan-btn.scanning {
            background-color: var(--primary-color);
            color: white;
        }

        .directory-path {
            font-family: monospace;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 2px 5px;
            border-radius: 3px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            display: inline-block;
            max-width: 100%;
        }

        body.dark-theme .directory-path {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .player-progress-container {
            width: 100%;
            margin: 15px 0;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .progress-bar-container {
            position: relative;
            height: 6px;
            cursor: pointer;
        }

        .progress-track {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-played {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #2e8b57, #3cb371);
            border-radius: 3px;
            width: 0%;
            z-index: 2;
        }

        .progress-buffered {
            position: absolute;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            width: 0%;
            z-index: 1;
        }

        .progress-thumb {
            position: absolute;
            width: 16px;
            /* ÈÄÇÂΩìÂ¢ûÂ§ß‰ª•‰æøÊòæÁ§∫GIFÂÜÖÂÆπ */
            height: 16px;
            background: url('1.gif') center/cover no-repeat;
            /* ÂÖ≥ÈîÆ‰øÆÊîπ */
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            opacity: 1;
            transition: opacity 0.2s;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .
        /* Ê≥¢Êµ™ÊïàÊûú */

        .wave-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 20 10" xmlns="http://www.w3.org/2000/svg"><path d="M0,5 C3,3 7,7 10,5 C13,3 17,7 20,5 L20,10 L0,10 Z" fill="rgba(255,255,255,0.2)"/></svg>');
            background-size: 20px 10px;
            animation: wave 1s linear infinite;
        }

        @keyframes wave {
            from {
                background-position-x: 0;
            }

            to {
                background-position-x: 20px;
            }
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ?*/

        @media (max-width: 768px) {
            .progress-bar-container {
                height: 8px;
            }

            .progress-thumb {
                width: 16px;
                height: 16px;
            }
        }
    </style>
</head>

<body>
    <!-- Ê∑ªÂä†ËÉåÊôØÂÆπÂô® -->
    <div class="music-bg-container" id="music-bg-container">
        <div class="music-bg-image" id="music-bg-image"></div>
    </div>
    <div class="container">
        <header>
            <div class="logo" id="about">Hillmusic</div>
            <div class="flex items-center">
                <div class="nav-tabs">
                    <div class="icon-tab" id="home-tab" title="È¶ñÈ°µ">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="icon-tab" id="theme-toggle-btn" title="ÂàáÊç¢‰∏ªÈ¢ò">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="icon-tab" id="clear-local-cache" title="Ê∏ÖÈô§ÁºìÂ≠ò">
                        <i class="fas fa-trash"></i>
                    </div>
                </div>
            </div>
        </header>
        <!-- Êñ∞Â¢û‰∏ªÈ°µÊé®ËçêÂå∫Âüü -->
        <div id="home-page">
            <!-- ÂäüËÉΩÊåâÈíÆÂå?-->
            <div class="feature-buttons">
                <div class="feature-btn search-tab" id="search-tab">
                    <i class="fas fa-compass"></i>
                    <span>ÂèëÁé∞Èü≥‰πê</span>
                </div>
                <div class="feature-btn local-tab" id="local-tab">
                    <i class="fas fa-download"></i>
                    <span>Êú¨Âú∞Èü≥‰πê</span>
                </div>
                <!-- tab-player -->
                <div class="feature-btn tab-music" id="tab-music">
                    <div class="tab-player" id="player-tab">
                        <!-- ËÉåÊôØÂõæÁâáÂÆπÂô® -->
                        <div class="tab-bg-image" id="tab-bg-image"></div>
                        <div class="tab-info">
                            <h3 id="tab-title">ü´ßÊ∞îÊ≥°Êí≠ÊîæÂô®ü´?/h3>
                            <p id="tab-artist">‰ºòË¥®ÂπøÂëä‰Ω?/p>
                        </div>
                        <div class="tab-controls">
                            <button class="tab-control-btn" id="tab-prev-btn">
                                <i class="fas fa-step-backward"></i>
                            </button>
                            <button class="tab-control-btn tab-play-btn" id="tab-play-btn">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="tab-control-btn" id="tab-next-btn">
                                <i class="fas fa-step-forward"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Êé®ËçêÊ≠åÂçïÂå?-->
            <div class="section">
                <h2 class="section-title">Êé®ËçêÊ≠åÂçï</h2>
                <div class="playlist-grid">
                    <!-- Âä®ÊÄÅÊ∑ªÂä†Ê≠åÂç?-->
                </div>
                <!-- Ê∑ªÂä†ÂØºËà™ÁÇ?-->
                <div class="playlist-nav-dots">
                    <span class="nav-dot" data-index="0"></span>
                    <span class="nav-dot active" data-index="1"></span>
                    <span class="nav-dot" data-index="2"></span>
                    <!-- ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅÊ∑ªÂä†Êõ¥Â§öÂØºËà™ÁÇπ -->
                </div>
            </div>
            <!-- Êé®ËçêÊ≠åÊõ≤Âå?-->
            <div class="section">
                <h2 class="section-title">Êé®ËçêÊ≠åÊõ≤</h2>
                <div class="song-list" id="recommended-songs">
                    <!-- Âä®ÊÄÅÊ∑ªÂä†Ê≠åÊõ?-->
                </div>
            </div>
        </div>
        <div id="search-page">
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="ÊêúÁ¥¢Ê≠åÊõ≤„ÄÅÊ≠åÊâ?..">
                <button class="search-btn" id="search-btn" title="ÊêúÁ¥¢">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <!-- Ê∑ªÂä†ÁÉ≠ÊêúÊ¶úÂå∫Âü?-->
            <div id="hot-search-section">
                <div class="trending-header">
                    <div class="chart-nav">
                        <button class="chart-nav-btn active" data-id="1">ÁÉ≠ÊêúÊ¶?/button>
                        <button class="chart-nav-btn" data-id="2">È£ôÂçáÊ¶?/button>
                        <button class="chart-nav-btn" data-id="3">Êñ∞Ê≠åÊ¶?/button>
                        <button class="chart-nav-btn" data-id="4">ÊµÅË°åÊ¶?/button>
                    </div>
                </div>
                <div class="hot-search-list" id="hot-search-list">
                    <!-- ÁÉ≠ÊêúÂÜÖÂÆπÂ∞ÜÂú®Ê≠§Âä®ÊÄÅÁîüÊà?-->
                </div>
            </div>
            <!-- ÊêúÁ¥¢ÁªìÊûúÂå∫Âüü -->
            <div id="search-result-section" style="display: none;">
                <div class="trending-header"
                    style="display: flex; justify-content: space-between; align-items: center;">
                    <div class="trending-title">ÊêúÁ¥¢ÁªìÊûú</div>
                    <button class="refresh-btn" id="refresh-trending">
                        <i class="fas fa-sync-alt"></i>
                        Âà∑Êñ∞
                    </button>
                </div>
                <div class="song-list" id="song-list">
                    <!-- ÊêúÁ¥¢ÁªìÊûúÂ∞ÜÂú®Ê≠§ÊòæÁ§?-->
                </div>
            </div>
        </div>
        <div id="player-page">
            <div class="player-container">
                <img id="now-playing-cover" class="now-playing-cover" src="favicon.png" alt="‰∏ìËæëÂ∞ÅÈù¢">
                <div class="now-playing-info">
                    <h2 id="now-playing-title" class="now-playing-title">Ê≠åÊõ≤Âê?/h2>
                    <p id="now-playing-artist" class="now-playing-artist">Êú™Áü•Ê≠åÊâã</p>
                </div>
                <!-- ‰øÆÊîπ player-controls ÈÉ®ÂàÜ -->
                <div class="player-controls">
                    <button class="player-control-btn" id="prev-btn">
                        <i class="fas fa-step-backward"></i>
                    </button>
                    <button class="player-control-btn" id="play-mode-btn" title="Êí≠ÊîæÊ®°Âºè">
                        <i class="fas fa-retweet"></i>
                    </button>
                    <button class="control-btn play-btn" id="play-pause-btn">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="player-control-btn" id="download-btn" title="‰∏ãËΩΩ">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="player-control-btn" id="next-btn">
                        <i class="fas fa-step-forward"></i>
                    </button>
                </div>
                <div class="player-progress-container">
                    <div class="time-display">
                        <span id="current-time">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                    <div class="progress-bar-container">
                        <!-- ËÉåÊôØËΩ®ÈÅì -->
                        <div class="progress-track"></div>
                        <!-- Â∑≤Êí≠ÊîæËøõÂ∫?-->
                        <div class="progress-played" id="progress-played">
                            <!-- Ê∑ªÂä†Ê≥¢Êµ™ÊïàÊûú -->
                            <div class="wave-effect"></div>
                        </div>
                        <!-- ÁºìÂÜ≤ËøõÂ∫¶ -->
                        <div class="progress-buffered" id="progress-buffered"></div>
                        <!-- ÊãñÂä®ÊéßÂà∂ÁÇ?-->
                        <div class="progress-thumb" id="progress-thumb"></div>
                    </div>
                </div>
                <audio id="audio-player" class="audio-player"></audio>
            </div>
            <button class="back-to-player" id="back-to-player">
                <i class="fas fa-arrow-left"></i>
            </button>
            <!-- Ê≠åËØçÈ°µÈù¢ -->
            <div class="lyrics-container" id="lyrics-container">
                <div class="lyrics-content" id="lyrics-content">
                    Êàë‰ª¨Ë¶ÅÊòéÁôΩ‰∫∫ÁîüÂ∫îËØ•ÊòØËá™Áî±ÁöÑÔºÅ
                </div>
            </div>
        </div>
        <!-- Êñ∞Â¢ûÊú¨Âú∞Èü≥‰πêÈ°µÈù¢ -->
        <!-- Êú¨Âú∞Èü≥‰πêÈ°µÈù¢ -->
        <div id="local-music-page" style="display: none">
            <div class="search-container">
                <input type="text" class="search-input" id="local-search-input" placeholder="ÊêúÁ¥¢Êú¨Âú∞Èü≥‰πê...">
                <button class="search-btn" id="local-search-btn" title="ÊêúÁ¥¢Êú¨Âú∞Èü≥‰πê">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="trending-header">
                <div class="trending-title">Êú¨Âú∞Èü≥‰πê</div>
                <div style="display: flex; gap: 10px">
                    <button id="scan-toggle-btn" class="refresh-btn scan-btn">
                        <i class="fas fa-sync-alt"></i> <span id="scan-btn-text">Êâ´Êèè</span>
                    </button>
                </div>
            </div>
            <div id="scan-progress" class="scan-progress" style="display: none;">
                <div class="scan-status">
                    <div class="scan-spinner"></div>
                    <div class="progress-text" id="scan-status-text">Ê≠£Âú®Êâ´Êèè...</div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="scan-progress-bar" style="width: 0%"></div>
                </div>
                <div class="stats" id="scan-stats">
                </div>
            </div>
            <div class="song-list" id="local-song-list">
                <!-- ÈªòËÆ§ÊòæÁ§∫ÊèêÁ§∫ -->
                <div class="empty-state">ÁÇπÂáªÊâ´ÊèèÊåâÈíÆÊü•ÊâæÊú¨Âú∞Èü≥‰πê</div>
            </div>
        </div>
        <!-- Ê≠åÂçïËØ¶ÊÉÖÈ°?-->
        <div class="playlist-detail-page" id="playlist-detail-page">
            <div class="playlist-detail-header">
                <button class="back-to-home" id="back-to-home">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="playlist-detail-cover">
                    <img id="playlist-cover" src="favicon.png" alt="Ê≠åÂçïÂ∞ÅÈù¢">
                </div>
                <div class="playlist-detail-info">
                    <h1 id="playlist-title" class="playlist-detail-title">Ê≠åÂçïÂêçÁß∞</h1>
                    <p id="playlist-description" class="playlist-detail-description">Ê≠åÂçïÁÆÄ‰ª?/p>
                    <div class="playlist-detail-stats">
                        <span id="playlist-song-count">0 È¶ñÊ≠åÊõ?/span>
                        <span id="playlist-play-count">0 Ê¨°Êí≠Êî?/span>
                    </div>
                </div>
            </div>
            <div class="playlist-songs-header">
                <h2 class="playlist-songs-title">Ê≠åÊõ≤ÂàóË°®</h2>
                <div class="playlist-controls">
                    <button class="control-btn play-all-btn" id="play-all-btn">
                        <i class="fas fa-play"></i>
                    </button>
                </div>
            </div>
            <div class="song-list" id="playlist-songs"></div>
        </div>
    </div>
    <!-- Mini player -->
    <div class="mini-player" id="mini-player" style="display: none">
        <img id="mini-player-cover" class="mini-player-cover" src="" alt="‰∏ìËæëÂ∞ÅÈù¢">
        <div class="mini-player-info">
            <div id="mini-player-title" class="mini-player-title">
            </div>
            <div id="mini-player-artist" class="mini-player-artist"></div>
        </div>
        <div class="mini-player-controls">
            <button class="control-btn" id="mini-prev-btn">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn play-btn" id="mini-play-pause-btn">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-btn" id="mini-next-btn">
                <i class="fas fa-step-forward"></i>
            </button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('search-input');
            const searchBtn = document.getElementById('search-btn');
            const songList = document.getElementById('song-list');
            const searchTab = document.getElementById('search-tab');
            const playerTab = document.getElementById('player-tab');
            const localTab = document.getElementById('local-tab');
            const searchPage = document.getElementById('search-page');
            const playerPage = document.getElementById('player-page');
            const localMusicPage = document.getElementById('local-music-page');
            const nowPlayingCover = document.getElementById('now-playing-cover');
            const nowPlayingTitle = document.getElementById('now-playing-title');
            const nowPlayingArtist = document.getElementById('now-playing-artist');
            const audioPlayer = document.getElementById('audio-player');
            const refreshresultBtn = document.getElementById('refresh-result');
            const miniPlayer = document.getElementById('mini-player');
            const miniPlayerCover = document.getElementById('mini-player-cover');
            const miniPlayerTitle = document.getElementById('mini-player-title');
            const miniPlayerArtist = document.getElementById('mini-player-artist');
            const miniPlayPauseBtn = document.getElementById('mini-play-pause-btn');
            const miniPrevBtn = document.getElementById('mini-prev-btn');
            const miniNextBtn = document.getElementById('mini-next-btn');
            //Êí≠ÊîæÊéßÂà∂ÊåâÈíÆ
            const playPauseBtn = document.getElementById('play-pause-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const playModeBtn = document.getElementById('play-mode-btn');
            const downloadBtn = document.getElementById('download-btn');
            let playMode = 'sequence'; // sequence, shuffle, repeat
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const lyricsContainer = document.getElementById('lyrics-container');
            const lyricsContent = document.getElementById('lyrics-content');
            const backToPlayerBtn = document.getElementById('back-to-player');
            const playerContainer = document.querySelector('.player-container');
            const homeTab = document.getElementById('home-tab');
            const homePage = document.getElementById('home-page');
            const recommendedSongs = document.getElementById('recommended-songs');
            // Ê≠åÂçïËØ¶ÊÉÖÈ°µÁõ∏ÂÖ≥ÂèòÈá?            const playlistDetailPage = document.getElementById('playlist-detail-page');
            const playlistCover = document.getElementById('playlist-cover');
            const playlistTitle = document.getElementById('playlist-title');
            const playlistDescription = document.getElementById('playlist-description');
            const playlistSongCount = document.getElementById('playlist-song-count');
            const playlistPlayCount = document.getElementById('playlist-play-count');
            const playlistSongs = document.getElementById('playlist-songs');
            const playAllBtn = document.getElementById('play-all-btn');
            // Ëé∑ÂèñtabÊí≠ÊîæÂô®ÂÖÉÁ¥?            const tabAudio = document.getElementById('tab-audio');
            const tabPlayBtn = document.getElementById('tab-play-btn');
            const tabPrevBtn = document.getElementById('tab-prev-btn');
            const tabNextBtn = document.getElementById('tab-next-btn');
            const tabTitle = document.getElementById('tab-title');
            const tabArtist = document.getElementById('tab-artist');
            const tabBgImage = document.getElementById('tab-bg-image');
            let songs = [];
            let currentSong = null;
            let currentSongIndex = -1;
            let isPlaying = false;
            let isShuffle = false;
            let isRepeat = false;
            let isPlayerPageActive = false;
            let lyricLines = [];
            let currentLyricIndex = -1;
            let adTimeout;
            let adInterval;
            let currentAdIndex = 0;
            let adSwitchInterval; // Áî®‰∫éÊéßÂà∂Êí≠ÊîæÊó∂ÂÆöÊúüÂàáÊç¢Âà∞ÂπøÂëäÁöÑÂÆöÊó∂Âô®
            const AD_SWITCH_INTERVAL = 30000; // Ëá™Âä®ÂàáÊç¢Âà∞ÂπøÂëäÊ®°ÂºèÁöÑÊó∂Èó¥



            //ÂπøÂëäÂàóË°®
            const adImages = [
                'url(Âπ?.jpg)',
                'url(Âπ?.gif)',
                'url(1.gif)'
            ];
            const musicBg = 'url(favicon.png)';
            // Check for saved theme preference
            themeToggleBtn.addEventListener('click', function () {
                const isDarkTheme = document.body.classList.toggle('dark-theme');
                localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
                updateThemeIcon();
            });
            // ÂàùÂßãÂä†ËΩΩÁÉ≠ÊêúÊ¶?            loadHotSearchData(1);

            function updateThemeIcon() {
                const isDarkTheme = document.body.classList.contains('dark-theme');
                themeToggleBtn.innerHTML = isDarkTheme ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            }
            // ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÊï∞Áª?            const searchKeywords = [
                "ÁªèÂÖ∏", "ÁÉ≠Èó®", "ÊµÅË°å", "‰º§ÊÑü",
                "Á∫ØÈü≥‰π?, "Ëã±ËØ≠", "ÊëáÊªö", "ÊäñÈü≥",
                "Ê≤ªÊÑà", "Âä±Âøó"
            ];
            // ÂàùÂßãÂåñÈ°µÈù¢Áä∂ÊÄ?            function initializePageState() {
                // ÈªòËÆ§Âè™ÊòæÁ§∫È¶ñÈ°µÔºåÈöêËóèÂÖ∂‰ªñÈ°µÈù¢
                homePage.style.display = 'block';
                searchPage.style.display = 'none';
                playerPage.style.display = 'none';
                localMusicPage.style.display = 'none';
                // ËÆæÁΩÆÈ¶ñÈ°µtab‰∏∫ÊøÄÊ¥?                homeTab.classList.add('active');
                searchTab.classList.remove('active');
                localTab.classList.remove('active');
                playerTab.classList.remove('active');
                // ÂàùÂßãÂåñÊé®ËçêÊ≠åÂç?                initializePlaylists();
                // Âä†ËΩΩÈ¶ñÈ°µÊé®ËçêÊ≠åÊõ≤
                loadRecommendedSongs();
            }
            // ÂàùÂßãÂåñÊé®ËçêÊ≠åÂç?            const playlists = [{
                id: 'hot',
                name: 'ÁÉ≠Èó®Ê≠åÂçï',
                keyword: 'ÁÉ≠Èó®'
            }, {
                id: 'classic',
                name: 'ÁªèÂÖ∏ËÄÅÊ≠å',
                keyword: 'ÁªèÂÖ∏'
            }, {
                id: 'heal',
                name: 'Ê≤ªÊÑàÈü≥‰πê',
                keyword: 'Ê≤ªÊÑà'
            }, {
                id: 'english',
                name: 'Ëã±ËØ≠ÊµÅË°å',
                keyword: 'Ëã±Êñá'
            }, {
                id: 'rock',
                name: 'ÊëáÊªö‰π?,
                keyword: 'ÊëáÊªö'
            }, {
                id: 'douyin',
                name: 'ÊäñÈü≥ÁÉ≠Ê≠å',
                keyword: 'ÊäñÈü≥'
            }, {
                id: 'piano',
                name: 'Èí¢Áê¥Êõ?,
                keyword: 'Èí¢Áê¥Êõ?
            }, {
                id: 'Âä±Âøó',
                name: 'Âä±ÂøóÊ≠åÊõ≤',
                keyword: 'Âä±Âøó'
            }, {
                id: 'sad',
                name: '‰º§ÊÑüÊÉÖÊ≠å',
                keyword: '‰º§ÊÑü'
            }, {
                id: 'pure',
                name: 'Á∫ØÈü≥‰π?,
                keyword: 'Á∫ØÈü≥‰π?
            }];
            async function initializePlaylists() {
                const playlistGrid = document.querySelector('.playlist-grid');
                playlistGrid.innerHTML = '';
                // ‰∏∫ÊØè‰∏™Ê≠åÂçïËé∑ÂèñÂâç‰∏âÈ¶ñÊ≠åÁöÑÂ∞ÅÈù¢
                for (const playlist of playlists) {
                    try {
                        // Ëé∑ÂèñÊ≠åÂçïÊ≠åÊõ≤ÂàóË°®
                        const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=&type=json&msg=${encodeURIComponent(playlist.keyword)}`);
                        const result = await response.json();
                        if (result.code === 200 && result.data) {
                            // Ëé∑ÂèñÂâç‰∏âÈ¶ñÊ≠åÁöÑËØ¶ÊÉ?                            const coverPromises = result.data.slice(0, 3).map(async song => {
                                try {
                                    const details = await getSongDetails(1, song.song_title);
                                    return details.image || song.cover || song.pic || 'favicon.png';
                                } catch (error) {
                                    return 'favicon.png';
                                }
                            });
                            playlist.covers = await Promise.all(coverPromises);
                        } else {
                            playlist.covers = ['favicon.png', 'favicon.png', 'favicon.png'];
                        }
                    } catch (error) {
                        console.error(`Ëé∑ÂèñÊ≠åÂçï ${playlist.name} Â∞ÅÈù¢Â§±Ë¥•:`, error);
                        playlist.covers = ['favicon.png', 'favicon.png', 'favicon.png'];
                    }
                    // ÂàõÂª∫Ê≠åÂçïÂÖÉÁ¥†
                    const playlistItem = document.createElement('div');
                    playlistItem.className = 'playlist-item';
                    // ÂàõÂª∫Â∞ÅÈù¢Â†ÜÂè†ÂÆπÂô®
                    const coverContainer = document.createElement('div');
                    coverContainer.className = 'playlist-cover-container';
                    // ÂàõÂª∫Â∞ÅÈù¢Â†ÜÂè†
                    const coverStack = document.createElement('div');
                    coverStack.className = 'playlist-cover-stack';
                    // Ê∑ªÂä†‰∏âÂº†ÈáçÂè†ÁöÑÂ∞ÅÈù?                    playlist.covers.forEach(cover => {
                        const coverImg = document.createElement('img');
                        coverImg.className = 'playlist-cover-image';
                        coverImg.src = cover;
                        coverImg.alt = playlist.name;
                        coverStack.appendChild(coverImg);
                    });
                    coverContainer.appendChild(coverStack);
                    // Ê∑ªÂä†Ê≠åÂçï‰ø°ÊÅØ
                    const infoContainer = document.createElement('div');
                    infoContainer.className = 'playlist-info';
                    infoContainer.innerHTML = `
            <div class="playlist-name" style="font-weight: bold;text-align: center;">${playlist.name}</div>
        `;
                    playlistItem.appendChild(coverContainer);
                    playlistItem.appendChild(infoContainer);
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
                    playlistItem.addEventListener('click', () => {
                        showPlaylistDetail(playlist);
                    });
                    playlistGrid.appendChild(playlistItem);
                }
            }
            // Âä†ËΩΩÊé®ËçêÊ≠åÊõ≤
            async function loadRecommendedSongs() {
                try {
                    // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ÂÖ≥ÈîÆËØçÊù•Ëé∑ÂèñÊé®ËçêÊ≠åÊõ?                    const randomKeyword = searchKeywords[Math.floor(Math.random() * searchKeywords.length)];
                    const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=&type=json&msg=${encodeURIComponent(randomKeyword)}`);
                    const result = await response.json();
                    if (result.code === 200 && result.data) {
                        // ÈôêÂà∂ÊòæÁ§∫Ââ?0È¶ñÊ≠åÊõ?                        const recommendedList = result.data.slice(0, 10);
                        displayRecommendedSongs(recommendedList);
                    }
                } catch (error) {
                    console.error('Âä†ËΩΩÊé®ËçêÊ≠åÊõ≤Â§±Ë¥•:', error);
                    recommendedSongs.innerHTML = '<div class="empty-state">Âä†ËΩΩÊé®ËçêÊ≠åÊõ≤Â§±Ë¥•</div>';
                }
            }
            // ÊòæÁ§∫Êé®ËçêÊ≠åÊõ≤
            async function displayRecommendedSongs(songList) {
                recommendedSongs.innerHTML = '';
                // ‰ΩøÁî® Promise.all Âπ∂ÂèëËé∑ÂèñÊâÄÊúâÊ≠åÊõ≤ËØ¶ÊÉ?                const songsWithDetails = await Promise.all(songList.map(async (song, index) => {
                    try {
                        const details = await getSongDetails(index + 1, song.song_title);
                        return {
                            ...song,
                            ...details,
                            title: details.title || song.song_title,
                            artist: details.artist || song.song_singer,
                            image: details.image || song.cover || song.pic || 'favicon.png'
                        };
                    } catch (error) {
                        console.error(`Ëé∑ÂèñÊ≠åÊõ≤„Ä?{song.song_title}„ÄãËØ¶ÊÉÖÂ§±Ë¥?`, error);
                        return song;
                    }
                }));
                songsWithDetails.forEach((song, index) => {
                    const songElement = document.createElement('div');
                    songElement.className = 'song-item';
                    songElement.innerHTML = `
            <div class="song-number">${index + 1}</div>
            <img src="${song.image}" class="song-cover" alt="${song.song_title}">
            <div class="song-info">
                <div class="song-title">${song.song_title || 'Êú™Áü•Ê≠åÊõ≤'}</div>
                <div class="song-artist">${song.song_singer || 'Êú™Áü•Ê≠åÊâã'}</div>
            </div>
            <div class="song-quality">${song.quality || 'HQÈ´òÂìÅ'}</div>
        `;
                    songElement.addEventListener('click', () => {
                        songs = songsWithDetails;
                        currentSongIndex = index;
                        currentSong = song;
                        playSong(song);
                    });
                    recommendedSongs.appendChild(songElement);
                });
            }
            // ÂàùÂßãÂåñÈ°µÈù¢Áä∂ÊÄ?            initializePageState();
            // ÂàáÊç¢Ê†áÁ≠æÈ°?            searchTab.addEventListener('click', function () {
                isPlayerPageActive = false;
                homePage.style.display = 'none';
                searchPage.style.display = 'block';
                playerPage.style.display = 'none';
                localMusicPage.style.display = 'none';
                playlistDetailPage.style.display = 'none';
                homeTab.classList.remove('active');
                searchTab.classList.add('active');
                localTab.classList.remove('active');
                playerTab.classList.remove('active');
                updateMiniPlayerVisibility();
            });
            playerTab.addEventListener('click', function (event) {
                // Ê£ÄÊü•ÁÇπÂáªÁõÆÊ†áÊòØÂê¶ÊòØÊí≠ÊîæÊéß‰ª∂ÊàñÂÖ∂Â≠êÂÖÉÁ¥?                const isClickOnPlayerControls = event.target.closest('.tab-controls'); // ÂÅáËÆæÊí≠ÊîæÊéß‰ª∂ÊúâÁ±ªÂê?player-controls'
                if (!isClickOnPlayerControls) {
                    isPlayerPageActive = true;
                    homePage.style.display = 'none';
                    searchPage.style.display = 'none';
                    playerPage.style.display = 'block';
                    localMusicPage.style.display = 'none';
                    playlistDetailPage.style.display = 'none';
                    homeTab.classList.remove('active');
                    searchTab.classList.remove('active');
                    localTab.classList.remove('active');
                    playerTab.classList.add('active');
                    updateMiniPlayerVisibility();
                }
            });
            // ÂàáÊç¢Âà∞Êú¨Âú∞Èü≥‰πêÈ°µÈù?            localTab.addEventListener('click', function () {
                isPlayerPageActive = false;
                homePage.style.display = 'none';
                searchPage.style.display = 'none';
                playerPage.style.display = 'none';
                playlistDetailPage.style.display = 'none';
                localMusicPage.style.display = 'block';
                homeTab.classList.remove('active');
                searchTab.classList.remove('active');
                localTab.classList.add('active');
                playerTab.classList.remove('active');
                updateMiniPlayerVisibility();
            });
            // È¶ñÈ°µtabÂàáÊç¢
            homeTab.addEventListener('click', function () {
                isPlayerPageActive = false;
                homePage.style.display = 'block';
                searchPage.style.display = 'none';
                playerPage.style.display = 'none';
                localMusicPage.style.display = 'none';
                playlistDetailPage.style.display = 'none';
                homeTab.classList.add('active');
                searchTab.classList.remove('active');
                localTab.classList.remove('active');
                playerTab.classList.remove('active');
                updateMiniPlayerVisibility();
            });

            function updateMiniPlayerVisibility() {
                if (isPlayerPageActive) {
                    miniPlayer.style.display = 'none';
                    playerPage.style.display = 'block';
                    playerPage.style.transform = 'translateY(0)';
                } else if (currentSong) {
                    miniPlayer.style.display = 'flex';
                    playerPage.style.transform = 'translateY(100%)';
                }
            }
            // ÊêúÁ¥¢ÂäüËÉΩ
            searchBtn.addEventListener('click', function () {
                const keyword = searchInput.value.trim();
                if (keyword) {
                    searchSongs();
                }
            });
            searchInput.addEventListener('input', function () {
                const keyword = this.value.trim();
                const hotSearchSection = document.getElementById('hot-search-section');
                const searchResultSection = document.getElementById('search-result-section');
                if (keyword) {
                    // ÊúâÊêúÁ¥¢ÂÖ≥ÈîÆËØçÊó∂ÈöêËóèÁÉ≠ÊêúÊ¶úÔºåÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûúÂå∫Âü?                    hotSearchSection.style.display = 'block';
                    searchResultSection.style.display = 'block';
                } else {
                    // Êó†ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÊó∂ÊòæÁ§∫ÁÉ≠ÊêúÊ¶úÔºåÈöêËóèÊêúÁ¥¢ÁªìÊûúÂå∫Âü?                    hotSearchSection.style.display = 'block';
                    searchResultSection.style.display = 'none';
                }
            });
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    searchSongs();
                }
            });
            // Audio player events
            audioPlayer.addEventListener('play', function () {
                isPlaying = true;
                updatePlayPauseButtons();
                updateLyricsHighlight();
            });
            audioPlayer.addEventListener('pause', function () {
                isPlaying = false;
                updatePlayPauseButtons();
            });
            audioPlayer.addEventListener('timeupdate', function () {
                updateLyricsHighlight();
            });
            audioPlayer.addEventListener('ended', function () {
                if (isRepeat) {
                    audioPlayer.currentTime = 0;
                    audioPlayer.play();
                } else {
                    playNextSong();
                }
            });
            // Ëé∑ÂèñDOMÂÖÉÁ¥†
            const progressPlayed = document.getElementById('progress-played');
            const progressBuffered = document.getElementById('progress-buffered');
            const progressThumb = document.getElementById('progress-thumb');
            const currentTimeDisplay = document.getElementById('current-time');
            const durationDisplay = document.getElementById('duration');
            const progressContainer = document.querySelector('.progress-bar-container');
            // Êõ¥Êñ∞ËøõÂ∫¶Êù?            audioPlayer.addEventListener('timeupdate', () => {
                const currentTime = audioPlayer.currentTime;
                const duration = audioPlayer.duration || 1;
                const progressPercent = (currentTime / duration) * 100;
                progressPlayed.style.width = `${progressPercent}%`;
                progressThumb.style.left = `${progressPercent}%`;
                // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
                currentTimeDisplay.textContent = formatTime(currentTime);
            });
            // Êõ¥Êñ∞ÁºìÂÜ≤ËøõÂ∫¶
            audioPlayer.addEventListener('progress', () => {
                if (audioPlayer.buffered.length > 0) {
                    const bufferedEnd = audioPlayer.buffered.end(audioPlayer.buffered.length - 1);
                    const duration = audioPlayer.duration || 1;
                    const bufferedPercent = (bufferedEnd / duration) * 100;
                    progressBuffered.style.width = `${bufferedPercent}%`;
                }
            });
            // ÁÇπÂáªË∑≥ËΩ¨
            progressContainer.addEventListener('click', (e) => {
                const rect = progressContainer.getBoundingClientRect();
                const clickPosition = (e.clientX - rect.left) / rect.width;
                const duration = audioPlayer.duration || 1;
                audioPlayer.currentTime = clickPosition * duration;
            });
            // ÊãñÂä®ÊéßÂà∂ÁÇ?            let isDragging = false;
            progressThumb.addEventListener('mousedown', () => {
                isDragging = true;
            });
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const rect = progressContainer.getBoundingClientRect();
                    let clickPosition = (e.clientX - rect.left) / rect.width;
                    clickPosition = Math.max(0, Math.min(1, clickPosition));
                    const duration = audioPlayer.duration || 1;
                    audioPlayer.currentTime = clickPosition * duration;
                }
            });
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            // Ê†ºÂºèÂåñÊó∂Èó¥ÊòæÁ§?            function formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            }
            // ÂàùÂßãÂåñÊó∂ÈïøÊòæÁ§?            audioPlayer.addEventListener('loadedmetadata', () => {
                durationDisplay.textContent = formatTime(audioPlayer.duration);
            });
            // Control buttons
            playPauseBtn.addEventListener('click', togglePlayPause);
            miniPlayPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', playPreviousSong);
            miniPrevBtn.addEventListener('click', playPreviousSong);
            nextBtn.addEventListener('click', playNextSong);
            miniNextBtn.addEventListener('click', playNextSong);
            // Lyrics view toggle
            nowPlayingCover.addEventListener('click', toggleLyricsView);
            nowPlayingTitle.addEventListener('click', toggleLyricsView);
            backToPlayerBtn.addEventListener('click', toggleLyricsView);
            lyricsContainer.addEventListener('click', toggleLyricsView);
            // Êí≠ÊîæÊ®°ÂºèÂàáÊç¢Â§ÑÁêÜ
            playModeBtn.addEventListener('click', () => {
                switch (playMode) {
                    case 'sequence':
                        playMode = 'shuffle';
                        isShuffle = true;
                        isRepeat = false;
                        playModeBtn.innerHTML = '<i class="fas fa-random"></i>';
                        modetext = 'ÈöèÊú∫Êí≠Êîæ'
                        break;
                    case 'shuffle':
                        playMode = 'repeat';
                        isShuffle = false;
                        isRepeat = true;
                        playModeBtn.innerHTML = '<i class="fas fa-redo"></i>';
                        modetext = 'ÂçïÊõ≤Âæ™ÁéØ'
                        break;
                    case 'repeat':
                        playMode = 'sequence';
                        isShuffle = false;
                        isRepeat = false;
                        playModeBtn.innerHTML = '<i class="fas fa-retweet"></i>';
                        modetext = 'È°∫Â∫èÊí≠Êîæ'
                        break;
                }
                webapp.toast(`Â∑≤ÂàáÊç¢‰∏∫${modetext}`);
            });
            // ‰∏ãËΩΩÊåâÈíÆÂ§ÑÁêÜ
            downloadBtn.addEventListener('click', async () => {
                if (!currentSong) {
                    webapp.toast('ÂΩìÂâçÊ≤°ÊúâÊ≠£Âú®Êí≠ÊîæÁöÑÊ≠åÊõ?);
                    return;
                }
                // Ê∑ªÂä†‰∏ãËΩΩ‰∏≠Áä∂ÊÄ?                downloadBtn.classList.add('downloading');
                try {
                    // Ê£ÄÊü•Â≠òÂÇ®ÊùÉÈô?                    if (!webapp.bestow()) {
                        webapp.rights(); // ËØ∑Ê±ÇÂ≠òÂÇ®ÊùÉÈôê
                        webapp.toast('ËØ∑ÂÖàÊéà‰∫àÂ≠òÂÇ®ÊùÉÈôê');
                        return;
                    }
                    // Â§ÑÁêÜÊñá‰ª∂ÂêçÔºåÊõøÊç¢ÈùûÊ≥ïÂ≠óÁ¨¶
                    const fileName = `${currentSong.artist}-${currentSong.title}`.replace(/[\\/:*?"<>|]/g, '_');
                    const downloadDir = '/storage/emulated/0/HillMusic/song/';
                    // Á°Æ‰øù‰∏ãËΩΩÁõÆÂΩïÂ≠òÂú®
                    if (!webapp.stayfile(downloadDir)) {
                        webapp.savefile(downloadDir, null); // ÂàõÂª∫ÁõÆÂΩï
                    }
                    if (currentSong.type === 'local') {
                        // Êú¨Âú∞Èü≥‰πêÂ§çÂà∂Âà∞‰∏ãËΩΩÁõÆÂΩ?                        const destPath = `${downloadDir}${fileName}.mp3`;
                        const fileData = webapp.gainfile(currentSong.path);
                        webapp.savefile(destPath, fileData);
                        webapp.toast('Â∑≤‰øùÂ≠òÂà∞‰∏ãËΩΩÊñá‰ª∂Â§?);
                    } else {
                        // Âú®Á∫øÈü≥‰πê‰∏ãËΩΩ - ‰ΩøÁî®WebIDEÁöÑ‰∏ãËΩΩÂäüËÉ?                        const downloadUrl = currentSong.url;
                        const destPath = `${downloadDir}${fileName}`;
                        // ÂÖà‰∏ãËΩΩÂà∞‰∏¥Êó∂Êñá‰ª∂
                        webapp.toast('ÂºÄÂßã‰∏ãËΩ?..');
                        // ‰ΩøÁî®fetchËé∑ÂèñÊñá‰ª∂Êï∞ÊçÆ
                        const response = await fetch(downloadUrl);
                        const blob = await response.blob();
                        const reader = new FileReader();
                        reader.onload = function () {
                            const base64Data = reader.result.split(',')[1];
                            webapp.savefile(destPath, `data:audio/mpeg;base64,${base64Data}`);
                            webapp.toast('‰∏ãËΩΩÂÆåÊàêÔº?);
                            webapp.toast(`‰øùÂ≠òË∑ØÂæÑÔº?{downloadDir}`);
                        };
                        reader.readAsDataURL(blob);
                    }
                } catch (error) {
                    webapp.toast('‰∏ãËΩΩÂ§±Ë¥•Ôº? + error.message);
                    console.error('‰∏ãËΩΩÈîôËØØ:', error);
                } finally {
                    downloadBtn.classList.remove('downloading');
                }
            });

            function toggleLyricsView() {
                if (lyricsContainer.style.display === 'none') {
                    playerContainer.style.display = 'none';
                    lyricsContainer.style.display = 'block';
                    lyricsContainer.classList.add('show');
                    backToPlayerBtn.style.display = 'block';
                } else {
                    playerContainer.style.display = 'flex';
                    lyricsContainer.style.display = 'none';
                    lyricsContainer.classList.remove('show');
                    backToPlayerBtn.style.display = 'none';
                }
            }

            function togglePlayPause() {
                if (!currentSong) {
                    playNextSong();
                } else {
                    if (isPlaying) {
                        audioPlayer.pause();
                    } else {
                        audioPlayer.play().catch(e => console.log('Êí≠ÊîæÂ§±Ë¥•:', e));
                    }
                }
            }

            function playPreviousSong() {
                if (songs.length === 0) return;
                if (currentSongIndex <= 0) {
                    currentSongIndex = songs.length - 1;
                } else {
                    currentSongIndex--;
                }
                currentSong = songs[currentSongIndex];
                playSong(currentSong);
            }

            function playNextSong() {
                if (songs.length === 0) return;
                if (isShuffle) {
                    currentSongIndex = Math.floor(Math.random() * songs.length);
                } else {
                    if (currentSongIndex >= songs.length - 1) {
                        currentSongIndex = 0;
                    } else {
                        currentSongIndex++;
                    }
                }
                currentSong = songs[currentSongIndex];
                playSong(currentSong);
            }

            function toggleShuffle() {
                isShuffle = !isShuffle;
                shuffleBtn.classList.toggle('active', isShuffle);
            }

            function toggleRepeat() {
                isRepeat = !isRepeat;
                repeatBtn.classList.toggle('active', isRepeat);
            }

            function updatePlayPauseButtons() {
                const playIcon = '<i class="fas fa-play"></i>';
                const pauseIcon = '<i class="fas fa-pause"></i>';
                if (isPlaying) {
                    playPauseBtn.innerHTML = pauseIcon;
                    miniPlayPauseBtn.innerHTML = pauseIcon;
                } else {
                    playPauseBtn.innerHTML = playIcon;
                    miniPlayPauseBtn.innerHTML = playIcon;
                }
            } -
                function loadDefaultSongs() {
                    // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ÊêúÁ¥¢ÂÖ≥ÈîÆËØç
                    const randomKeyword = searchKeywords[Math.floor(Math.random() * searchKeywords.length)];
                    searchInput.value = randomKeyword;
                    searchSongs();
                }
            // ÁºìÂ≠òÊêúÁ¥¢ÁªìÊûúÔºå‰ΩøÁî®LRUÁ≠ñÁï•Èò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºè
            const searchCache = new Map();
            const MAX_CACHE_SIZE = 50; // ÊúÄÂ§ßÁºìÂ≠òÊï∞Èá?            async function searchSongs() {
                const keyword = searchInput.value.trim();
                if (!keyword) {
                    return;
                }

                // Èò≤ÊäñÂ§ÑÁêÜÔºåÈÅøÂÖçÈ¢ëÁπÅÊêúÁ¥?                if (searchSongs.debounceTimer) {
                    clearTimeout(searchSongs.debounceTimer);
                }

                // ÂàáÊç¢ÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûúÂå∫Âüü
                const hotSearchSection = document.getElementById('hot-search-section');
                const searchResultSection = document.getElementById('search-result-section');
                hotSearchSection.style.display = 'none';
                searchResultSection.style.display = 'block';

                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄ?                songList.innerHTML = '<div class="loading">Ê≠£Âú®ÊêúÁ¥¢...</div>';

                try {
                    // Ê£ÄÊü•ÁºìÂ≠?                    if (searchCache.has(keyword)) {
                        const cachedData = searchCache.get(keyword);
                        // Êõ¥Êñ∞ÁºìÂ≠òÊó∂Èó¥Êà?                        searchCache.delete(keyword);
                        searchCache.set(keyword, cachedData);
                        displaySongList(cachedData.songs);
                        return;
                    }

                    // Ê∑ªÂä†ÊêúÁ¥¢‰∏≠Áä∂ÊÄ?                    searchInput.disabled = true;

                    // ‰ΩøÁî®Èò≤ÊäñÁ°Æ‰øùÁî®Êà∑ÂÅúÊ≠¢ËæìÂÖ•ÂêéÂÜçÂèëÈÄÅËØ∑Ê±?                    searchSongs.debounceTimer = setTimeout(async () => {
                        try {
                            // ‰ΩøÁî®AbortControllerÂÆûÁé∞ËØ∑Ê±ÇÂèñÊ∂à
                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 10000); // 10ÁßíË∂ÖÊó?
                            const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=&type=json&msg=${encodeURIComponent(keyword)}`, {
                                signal: controller.signal,
                                cache: 'force-cache'
                            });

                            clearTimeout(timeoutId);

                            // Ê£ÄÊü•ÂìçÂ∫îÁä∂ÊÄ?                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }

                            const result = await response.json();
                            if (!result) {
                                throw new Error('Empty response from server');
                            }

                            // Ëß£ÊûêÊ≠åÊõ≤ÂàóË°®
                            const songListData = parseSongListWithIndices(result);

                            // È™åËØÅËß£ÊûêÁªìÊûú
                            if (!Array.isArray(songListData)) {
                                throw new Error('Invalid song list format');
                            }

                            // ÂÖàÂø´ÈÄüÊòæÁ§∫Âü∫Êú¨ÂàóË°®Ôºà‰ΩøÁî®Âç†‰ΩçÂõæÔºâ
                            const basicSongs = songListData.map((song, index) => ({
                                ...song,
                                image: 'favicon.png', // ‰ΩøÁî®logo.png‰Ωú‰∏∫Âç†‰ΩçÂõ?                                quality: 'SQÊó†Êçü'
                            }));

                            // Á´ãÂç≥ÊòæÁ§∫Âü∫Êú¨ÂàóË°®
                            displaySongList(basicSongs);

                            // ÁÑ∂ÂêéÂºÇÊ≠•Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ
                            setTimeout(async () => {
                                try {
                                    const detailedSongs = await getAllSongDetails(songListData);



                                    // ÁºìÂ≠òÁªìÊûú
                                    if (searchCache.size >= MAX_CACHE_SIZE) {
                                        // LRUÁ≠ñÁï•ÔºöÂà†Èô§ÊúÄ‰πÖÊú™‰ΩøÁî®ÁöÑÁºìÂ≠?                                        const oldestKey = searchCache.keys().next().value;
                                        searchCache.delete(oldestKey);
                                    }
                                    searchCache.set(keyword, {
                                        timestamp: Date.now(),
                                        songs: detailedSongs
                                    });
                                } catch (error) {
                                    console.error('Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØÂ§±Ë¥•:', error);
                                    webapp.toast('ÈÉ®ÂàÜÊ≠åÊõ≤ËØ¶ÊÉÖÂä†ËΩΩÂ§±Ë¥•');
                                }
                            }, 0);

                        } catch (error) {
                            console.error('ÊêúÁ¥¢Â§±Ë¥•:', error);
                            if (error.name !== 'AbortError') {
                                songList.innerHTML = '<div class="empty-state">ÊêúÁ¥¢Â§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï</div>';
                            }
                        } finally {
                            searchInput.disabled = false;
                        }
                    }, 500); // 500ÊØ´ÁßíÈò≤ÊäñÂª∂Ëøü
                } catch (error) {
                    console.error('ÊêúÁ¥¢ÂàùÂßãÂåñÂ§±Ë¥?', error);
                    songList.innerHTML = '<div class="empty-state">ÊêúÁ¥¢ÂàùÂßãÂåñÂ§±Ë¥?/div>';
                    searchInput.disabled = false;
                }
            }

            async function getAllSongDetails(songIndices) {
                const songsWithDetails = [];

                // ÈôêÂà∂ÊúÄÂ§öËé∑ÂèñÂâç50È¶ñÊ≠åÊõ≤ÁöÑËØ¶ÊÉÖ
                const limitedIndices = songIndices.slice(0, 50);

                // ‰ΩøÁî®Promise.allÂπ∂ÂèëËé∑ÂèñËØ¶ÊÉÖÔºå‰ΩÜÈôêÂà∂Âπ∂ÂèëÊï?                const batchSize = 5; // ÊØèÊ¨°Âπ∂Âèë5‰∏™ËØ∑Ê±?                for (let i = 0; i < limitedIndices.length; i += batchSize) {
                    const batch = limitedIndices.slice(i, i + batchSize);
                    const batchPromises = batch.map(song => getSongDetails(song.index, song.title));

                    try {
                        const batchResults = await Promise.all(batchPromises);
                        batch.forEach((song, j) => {
                            songsWithDetails.push({
                                ...song,
                                ...batchResults[j],
                                lyrics: batchResults[j].lyrics || 'Ê≠åËØçÂä†ËΩΩ‰∏?..'
                            });
                        });



                    } catch (error) {
                        console.error('ÊâπÈáèËé∑ÂèñÊ≠åÊõ≤ËØ¶ÊÉÖÂ§±Ë¥•:', error);
                        // Âç≥‰ΩøÈÉ®ÂàÜÂ§±Ë¥•‰πüÁªßÁª≠Â§ÑÁêÜÂÖ∂‰ªñÊ≠åÊõ?                        batch.forEach(song => {
                            songsWithDetails.push({
                                ...song,
                                title: song.title,
                                artist: song.artist,
                                image: 'favicon.png',
                                lyrics: 'Ê≠åËØçÂä†ËΩΩ‰∏?..'
                            });
                        });
                    }
                }

                return songsWithDetails;
            }

            function updateSongDetails(detailedSongs) {
                const songElements = document.querySelectorAll('.song-item');

                detailedSongs.forEach((song, index) => {
                    if (index < songElements.length) {
                        const songElement = songElements[index];
                        const coverImg = songElement.querySelector('.song-cover');
                        const qualityDiv = songElement.querySelector('.song-quality');

                        // Êõ¥Êñ∞Â∞ÅÈù¢ÔºàÂ¶ÇÊûúËé∑ÂèñÂà∞‰∫ÜÊñ∞Â∞ÅÈù¢Ôº?                        if (song.image && song.image !== 'favicon.png') {
                            coverImg.src = song.image;
                        }

                        // Êõ¥Êñ∞Èü≥Ë¥®‰ø°ÊÅØ
                        if (song.quality) {
                            qualityDiv.textContent = song.quality;
                        }

                        // Êõ¥Êñ∞ÁÇπÂáª‰∫ã‰ª∂
                        songElement.onclick = function () {
                            // Êõ¥Êñ∞ÂΩìÂâçÈÄâ‰∏≠Ê≠åÊõ≤
                            document.querySelectorAll('.song-item').forEach(el => {
                                el.classList.remove('active');
                            });
                            this.classList.add('active');
                            currentSong = song;
                            currentSongIndex = index;
                            playSong(song);
                            // Êõ¥Êñ∞miniÊí≠ÊîæÂô®ÂèØËßÅÊÄ?                            updateMiniPlayerVisibility();
                        };
                    }
                });
            }

            function parseSongListWithIndices(jsonData) {
                try {
                    const data = typeof jsonData === 'string' ? JSON.parse(jsonData) : jsonData;
                    if (data.code !== 200 || !data.data) return [];
                    return data.data.map((song, index) => ({
                        index: index + 1, // ‰ΩøÁî®Êï∞ÁªÑÁ¥¢Âºï+1‰Ωú‰∏∫Â∫èÂè∑
                        title: song.song_title || 'Êú™Áü•Ê≠åÊõ≤',
                        artist: song.song_singer || 'Êú™Áü•Ê≠åÊâã'
                    }));
                } catch (error) {
                    console.error('Ëß£ÊûêÊ≠åÊõ≤ÂàóË°®Â§±Ë¥•:', error);
                    return [];
                }
            }
            async function getAllSongDetails(songIndices) {
                const songsWithDetails = [];
                for (const song of songIndices.slice(0, 50)) {
                    try {
                        const details = await getSongDetails(song.index, song.title);
                        songsWithDetails.push({
                            ...song,
                            ...details,
                            lyrics: details.lyrics || '[00:00.00]ÊöÇÊó†Ê≠åËØç'
                        });
                    } catch (error) {
                        console.error(`Ëé∑ÂèñÊ≠åÊõ≤„Ä?{song.title}„ÄãËØ¶ÊÉÖÂ§±Ë¥?`, error);
                    }
                }
                return songsWithDetails;
            }
            async function getSongDetails(index, title) {
                try {
                    const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=${index}&type=json&msg=${encodeURIComponent(title)}`);
                    const result = await response.json();
                    if (result.code === 200 && result.data) {
                        const songData = Array.isArray(result.data) ? result.data[0] : result.data;
                        return {
                            title: songData.song_name || songData.song_title || title,
                            artist: songData.song_singer || 'Êú™Áü•Ê≠åÊâã',
                            quality: songData.quality || 'SQÊó†Êçü',
                            image: songData.cover || songData.pic || 'favicon.png',
                            url: songData.music_url || '',
                            lyrics: songData.lyrics ? songData.lyric.replace(/\\n/g, '\n') : '[00:00.00]ÊöÇÊó†Ê≠åËØç',
                            platformLink: songData.link || ''
                        };
                    }
                    throw new Error(result.msg || 'Ê≠åÊõ≤Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•');
                } catch (error) {
                    console.error(`Ëé∑ÂèñÊ≠åÊõ≤„Ä?{title}„ÄãËØ¶ÊÉÖÂ§±Ë¥?`, error);
                    return {
                        title: title,
                        artist: 'Êú™Áü•Ê≠åÊâã',
                        image: 'favicon.png',
                        lyrics: '[00:00.00]ÊöÇÊó†Ê≠åËØç'
                    };
                }
            }

            function displaySongList(songs) {
                if (songs.length === 0) {
                    songList.innerHTML = '<div class="empty-state">Ê≤°ÊúâÊâæÂà∞Áõ∏ÂÖ≥Ê≠åÊõ≤</div>';
                    return;
                }

                songList.innerHTML = '';

                songs.forEach((song, index) => {
                    const songElement = document.createElement('div');
                    songElement.className = 'song-item';

                    if (currentSong && song.title === currentSong.title && song.artist === currentSong.artist) {
                        songElement.classList.add('active');
                    }

                    songElement.dataset.index = index;
                    songElement.innerHTML = `
            <div class="song-number">${index + 1}</div>

            <div class="song-info">
                <div class="song-title">${song.title}</div>
                <div class="song-artist">${song.artist}</div>
            </div>
            <div class="song-quality">${song.quality || 'Âä†ËΩΩ‰∏?..'}</div>
        `;

                    songElement.addEventListener('click', function () {
                        // Êõ¥Êñ∞ÂΩìÂâçÈÄâ‰∏≠Ê≠åÊõ≤
                        document.querySelectorAll('.song-item').forEach(el => {
                            el.classList.remove('active');
                        });
                        this.classList.add('active');
                        currentSong = song;
                        currentSongIndex = index;
                        playSong(song);
                        // Êõ¥Êñ∞miniÊí≠ÊîæÂô®ÂèØËßÅÊÄ?                        updateMiniPlayerVisibility();
                    });

                    songList.appendChild(songElement);
                });
            }
            // playSongÂáΩÊï∞
            function playSong(song) {
                // Êñ∞Â¢ûÔºöÈ™åËØÅÊú¨Âú∞Èü≥‰πêË∑ØÂæÑÊòØÂê¶Â≠òÂú?                if (song.path && !checkLocalFileExists(song.path)) {
                    removeInvalidSong(song); // ‰ªéÂàóË°®‰∏≠ÁßªÈô§Êó†ÊïàÊ≠åÊõ≤
                    return;
                }
                if (!song.url && !song.path) {
                    if (!song.triedGetDetails) {
                        song.triedGetDetails = true;
                        getSongDetails(song.searchIndex, song.title).then(details => {
                            Object.assign(song, details);
                            playSong(song);
                        });
                    }
                    return;
                }
                // Ê∏ÖÈô§ÊâÄÊúâÁõ∏ÂÖ≥ÂÆöÊó∂Âô®
                clearTimeout(adTimeout);
                clearInterval(adSwitchInterval);
                // ÂàáÊç¢Âà∞Êí≠ÊîæÊ®°Âº?                switchToPlayingMode();
                // ËÆæÁΩÆ30ÁßíÂêéËá™Âä®ÂàáÊç¢Âà∞ÂπøÂëäÊ®°Âº?                //adSwitchInterval = setInterval(() => {
                //if (isPlaying) {
                //switchToAdMode();
                // 5ÁßíÂêéËá™Âä®ÊÅ¢Â§çÊí≠Êîæ
                //setTimeout(() => {
                //if (!isPlaying) {
                //audioPlayer.play().catch(e => console.log('ÊÅ¢Â§çÊí≠ÊîæÂ§±Ë¥•:', e));
                //}
                //}, 5000);
                //}
                //}, AD_SWITCH_INTERVAL);
                // Êõ¥Êñ∞Êí≠ÊîæÈ°µ‰ø°ÊÅ?                nowPlayingCover.src = song.image || 'favicon.png';
                nowPlayingTitle.textContent = song.title;
                nowPlayingArtist.textContent = song.artist;
                // Êõ¥Êñ∞tabÊí≠ÊîæÂô®‰ø°ÊÅ?                tabTitle.textContent = song.title;
                tabArtist.textContent = song.artist;
                // Êõ¥Êñ∞ËÉåÊôØÂõæÁâá
                const bgImage = document.getElementById('music-bg-image');
                const tabBgImage = document.getElementById('tab-bg-image');
                if (song.image) {
                    bgImage.style.backgroundImage = `url(${song.image})`;
                    bgImage.classList.add('active');
                    tabBgImage.style.backgroundImage = `url(${song.image})`;
                    tabBgImage.classList.add('active');
                } else {
                    bgImage.classList.remove('active');
                    tabBgImage.classList.remove('active');
                }
                // Êõ¥Êñ∞Ê≠åËØç
                formatLyrics(song.lyrics || '[00:00.00]ÊöÇÊó†Ê≠åËØç');
                lyricsContent.innerHTML = formatLyricsForDisplay(song.lyrics || '[00:00.00]ÊöÇÊó†Ê≠åËØç');
                // Êõ¥Êñ∞mini player
                miniPlayerCover.src = song.image || 'favicon.png';
                miniPlayerTitle.textContent = song.title;
                miniPlayerArtist.textContent = song.artist;
                updateMiniPlayerVisibility();
                //ÂêØÂä®Âä®Áîª
                const tabMusic = document.querySelector('.tab-music');
                tabMusic.style.animationPlayState = 'running'; // ÂêØÂä®Âä®Áîª
                // Êõ¥Êñ∞Èü≥È¢ëÊí≠ÊîæÂô?                const audioSource = song.url || 'file://' + song.path;
                audioPlayer.src = audioSource;
                audioPlayer.load();
                audioPlayer.addEventListener('error', function handleError() {
                    webapp.toast('Êñá‰ª∂Âä†ËΩΩÂ§±Ë¥•ÔºåÂèØËÉΩË∑ØÂæÑÊó†ÊïàÊàñÊñá‰ª∂ÊçüÂùè');
                    audioPlayer.removeEventListener('error', handleError);
                    removeInvalidSong(song);
                });
                // Ëá™Âä®Êí≠Êîæ
                setTimeout(() => {
                    audioPlayer.play().catch(e => console.log('Ëá™Âä®Êí≠ÊîæÂ§±Ë¥•:', e));
                }, 500);
                // Êõ¥Êñ∞Ê≠åÊõ≤ÂàóË°®‰∏≠ÁöÑÈ´ò‰∫ÆÁä∂ÊÄ?                updateSongListHighlight();
            }
            //Èü≥‰πêÊí≠ÊîæËæÖÂä©ÂáΩÊï∞
            // Êñ∞Â¢ûÔºöÊ£ÄÊü•Êú¨Âú∞Êñá‰ª∂ÊòØÂê¶Â≠òÂú?            function checkLocalFileExists(filePath) {
                try {
                    // ‰ΩøÁî®webapp APIÊ£ÄÊü•Êñá‰ª∂Â≠òÂú®ÊÄ?                    return webapp.listfile(filePath) !== "null";
                } catch (error) {
                    console.error('Êñá‰ª∂Ê£ÄÊü•Â§±Ë¥?', error);
                    return false;
                }
            }
            /**
             * Êâ´ÊèèÂπ∂ÁßªÈô§ÊâÄÊúâÊó†ÊïàÊ≠åÊõ≤ÔºàË∑ØÂæÑÊó†ÊïàÊàñÊó†Ê≥ïÊí≠ÊîæÔºâ
             * @param {boolean} [updatePlayer=true] - ÊòØÂê¶Êõ¥Êñ∞Êí≠ÊîæÂô®Áä∂ÊÄ?             * @param {boolean} [saveToStorage=true] - ÊòØÂê¶‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ?             * @returns {Promise<{removedCount: number, invalidSongs: Array}>} ËøîÂõûÁßªÈô§Êï∞ÈáèÂíåÊó†ÊïàÊ≠åÊõ≤ÂàóË°?             */
            async function scanAndRemoveInvalidSongs(updatePlayer = true, saveToStorage = true) {
                console.group('ÂºÄÂßãÊâ´ÊèèÊó†ÊïàÊ≠åÊõ?);
                const invalidSongs = [];
                let removedCount = 0;
                try {
                    // ÂêàÂπ∂‰∏ªÂàóË°®ÂíåÊú¨Âú∞ÂàóË°®ÔºåÈÅøÂÖçÈáçÂ§çÊ£ÄÊü?                    const allSongs = [...new Set([...songs, ...localSongs])];
                    // Ê£ÄÊü•ÊØèÈ¶ñÊ≠åÊõ≤ÁöÑÊúâÊïàÊÄ?                    for (const song of allSongs) {
                        try {
                            // Ê£ÄÊü•Ë∑ØÂæÑÊúâÊïàÊÄ?                            const pathValid = await checkLocalFileExists(song.path);
                            if (!pathValid) {
                                console.warn(`[Ë∑ØÂæÑÊó†Êïà] ${song.path}`);
                                invalidSongs.push(song);
                                continue;
                            }
                            // Ê£ÄÊü•Êñá‰ª∂ÂèØÊí≠ÊîæÊÄ?                            const canPlay = await checkSongPlayability(song.path);
                            if (!canPlay) {
                                console.warn(`[Êó†Ê≥ïÊí≠Êîæ] ${song.path}`);
                                invalidSongs.push(song);
                                continue;
                            }
                            console.log(`[ÊúâÊïà] ${song.path}`);
                        } catch (error) {
                            console.error(`Ê£ÄÊü•Ê≠åÊõ≤Âá∫Èî? ${song.path}`, error);
                            invalidSongs.push(song);
                        }
                    }
                    // ÁßªÈô§ÊâÄÊúâÊó†ÊïàÊ≠åÊõ?                    if (invalidSongs.length > 0) {
                        console.log(`ÂèëÁé∞ ${invalidSongs.length} È¶ñÊó†ÊïàÊ≠åÊõ≤ÔºåÂºÄÂßãÁßªÈô?..`);
                        removedCount = await removeInvalidSongs(invalidSongs, updatePlayer, saveToStorage);
                    } else {
                        console.log('Êú™ÂèëÁé∞Êó†ÊïàÊ≠åÊõ?);
                    }
                    return {
                        removedCount,
                        invalidSongs
                    };
                } catch (error) {
                    console.error('Êâ´ÊèèÊó†ÊïàÊ≠åÊõ≤Êó∂Âá∫Èî?', error);
                    return {
                        removedCount: 0,
                        invalidSongs: []
                    };
                } finally {
                    console.groupEnd();
                }
            }
            /**
             * Ê£ÄÊü•Ê≠åÊõ≤Êñá‰ª∂ÊòØÂê¶ÂèØ‰ª•Êí≠Êî?             * @param {string} filePath - Ê≠åÊõ≤Ë∑ØÂæÑ
             * @returns {Promise<boolean>}
             */
            async function checkSongPlayability(filePath) {
                return new Promise((resolve) => {
                    const audio = new Audio();
                    audio.src = filePath;
                    // ËÆæÁΩÆË∂ÖÊó∂Ê£ÄÊµ?                    const timeout = setTimeout(() => {
                        audio.removeEventListener('canplaythrough', successHandler);
                        audio.removeEventListener('error', errorHandler);
                        resolve(false);
                    }, 5000); // 5ÁßíË∂ÖÊó?                    const successHandler = () => {
                        clearTimeout(timeout);
                        resolve(true);
                    };
                    const errorHandler = () => {
                        clearTimeout(timeout);
                        resolve(false);
                    };
                    audio.addEventListener('canplaythrough', successHandler, {
                        once: true
                    });
                    audio.addEventListener('error', errorHandler, {
                        once: true
                    });
                });
            }
            /**
             * ÊâπÈáèÁßªÈô§Êó†ÊïàÊ≠åÊõ≤
             * @param {Array} invalidSongs - Êó†ÊïàÊ≠åÊõ≤ÂàóË°®
             * @param {boolean} updatePlayer - ÊòØÂê¶Êõ¥Êñ∞Êí≠ÊîæÂô®Áä∂ÊÄ?             * @param {boolean} saveToStorage - ÊòØÂê¶‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ?             * @returns {number} ÂÆûÈôÖÁßªÈô§ÁöÑÊ≠åÊõ≤Êï∞Èá?             */
            async function removeInvalidSongs(invalidSongs, updatePlayer, saveToStorage) {
                if (!invalidSongs || invalidSongs.length === 0) return 0;
                try {
                    const initialMainCount = songs.length;
                    const initialLocalCount = localSongs.length;
                    // ÂàõÂª∫Êó†ÊïàË∑ØÂæÑÈõÜÂêà‰æø‰∫éÂø´ÈÄüÊü•Êâ?                    const invalidPaths = new Set(invalidSongs.map(song => song.path));
                    // ‰ªé‰∏ªÂàóË°®ÁßªÈô§
                    songs = songs.filter(song => !invalidPaths.has(song.path));
                    // ‰ªéÊú¨Âú∞ÂàóË°®ÁßªÈô?                    localSongs = localSongs.filter(song => !invalidPaths.has(song.path));
                    const mainRemoved = initialMainCount - songs.length;
                    const localRemoved = initialLocalCount - localSongs.length;
                    const totalRemoved = mainRemoved + localRemoved;
                    console.log(`ÁßªÈô§ÂÆåÊàê: ‰∏ªÂàóË°®ÁßªÈô§‰∫Ü ${mainRemoved} È¶ñÔºåÊú¨Âú∞ÂàóË°®ÁßªÈô§‰∫?${localRemoved} È¶ñ`);
                    // Ê£ÄÊü•Âπ∂Êõ¥Êñ∞ÂΩìÂâçÊí≠ÊîæÊ≠åÊõ≤
                    if (updatePlayer && currentSong && invalidPaths.has(currentSong.path)) {
                        console.log('ÂΩìÂâçÊí≠ÊîæÁöÑÊ≠åÊõ≤Â∑≤Â§±ÊïàÔºåÂÅúÊ≠¢Êí≠Êî?);
                        currentSong = null;
                        currentSongIndex = -1;
                        if (audioElement) {
                            audioElement.pause();
                            audioElement.src = '';
                        }
                        updatePlayerUI();
                    }
                    // Êõ¥Êñ∞UI
                    updateLocalMusicListUI();
                    displaySongList(songs);
                    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ?                    if (saveToStorage && totalRemoved > 0) {
                        saveLocalSongs();
                    }
                    return totalRemoved;
                } catch (error) {
                    console.error('ÊâπÈáèÁßªÈô§Êó†ÊïàÊ≠åÊõ≤Êó∂Âá∫Èî?', error);
                    return 0;
                }
            }
            // ËæÖÂä©ÂáΩÊï∞ÔºöÊ£ÄÊü•Êñá‰ª∂ÊòØÂê¶Â≠òÂú®ÔºàÁ§∫‰æãÂÆûÁé∞ÔºåÈúÄÊ†πÊçÆÂÆûÈôÖÁéØÂ¢ÉË∞ÉÊï¥Ôº?            async function checkLocalFileExists(filePath) {
                try {
                    // ËøôÈáå‰ΩøÁî®‰Ω†ÁöÑÂÆûÈôÖÊñá‰ª∂Ê£ÄÊü•ÊñπÊ≥?                    // ÂèØËÉΩÊò?webapp.gainsize() ÊàñÂÖ∂‰ªñAPI
                    const size = await webapp.gainsize(filePath);
                    return size > 0;
                } catch (error) {
                    return false;
                }
            }

            function formatLyrics(lyricsText) {
                // Ëß£ÊûêÊ≠åËØçÊñáÊú¨‰∏∫Êó∂Èó¥Ê†áÁ≠æÂíåÊ≠åËØçË°?                lyricLines = [];
                const lines = lyricsText.split('\n');
                lines.forEach(line => {
                    const timeMatch = line.match(/^\[(\d+):(\d+)\.(\d+)\]/);
                    if (timeMatch) {
                        const minutes = parseInt(timeMatch[1]);
                        const seconds = parseInt(timeMatch[2]);
                        const milliseconds = parseInt(timeMatch[3]);
                        const timeInSeconds = minutes * 60 + seconds + milliseconds / 100;
                        const lyricText = line.replace(timeMatch[0], '').trim();
                        if (lyricText) {
                            lyricLines.push({
                                time: timeInSeconds,
                                text: lyricText
                            });
                        }
                    }
                });
                // ÊåâÊó∂Èó¥ÊéíÂ∫?                lyricLines.sort((a, b) => a.time - b.time);
            }

            function formatLyricsForDisplay(lyricsText) {
                // Â∞ÜÊ≠åËØçÊ†ºÂºèÂåñ‰∏∫HTMLÊòæÁ§∫
                let html = '';
                const lines = lyricsText.split('\n');
                lines.forEach(line => {
                    if (line.trim() === '') {
                        html += '<br>';
                    } else if (line.startsWith('[') && line.includes(']')) {
                        const lyricText = line.replace(/^\[.*?\]/, '').trim();
                        if (lyricText) {
                            html += `<div class="lyric-line">${lyricText}</div>`;
                        }
                    } else {
                        html += `<div class="lyric-line">${line}</div>`;
                    }
                });
                return html || '<div class="lyric-line">ÊöÇÊó†Ê≠åËØç</div>';
            }

            function updateLyricsHighlight() {
                if (!lyricLines.length || !lyricsContainer.style.display === 'block') return;
                const currentTime = audioPlayer.currentTime;
                let newIndex = -1;
                // ÊâæÂà∞ÂΩìÂâçÂ∫îËØ•È´ò‰∫ÆÁöÑÊ≠åËØçË°å
                for (let i = 0; i < lyricLines.length; i++) {
                    if (currentTime >= lyricLines[i].time) {
                        newIndex = i;
                    } else {
                        break;
                    }
                }
                // Â¶ÇÊûúÊ≠åËØçË°åÊúâÂèòÂåñÔºåÊõ¥Êñ∞È´ò‰∫?                if (newIndex !== currentLyricIndex) {
                    const lyricElements = lyricsContent.querySelectorAll('.lyric-line');
                    // ÁßªÈô§ÊóßÁöÑÈ´ò‰∫Æ
                    if (currentLyricIndex >= 0 && currentLyricIndex < lyricElements.length) {
                        lyricElements[currentLyricIndex].classList.remove('active');
                    }
                    // Ê∑ªÂä†Êñ∞ÁöÑÈ´ò‰∫Æ
                    if (newIndex >= 0 && newIndex < lyricElements.length) {
                        lyricElements[newIndex].classList.add('active');
                        // ÊªöÂä®Âà∞ÂΩìÂâçÊ≠åËØç‰ΩçÁΩ?                        lyricElements[newIndex].scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                    currentLyricIndex = newIndex;
                }
            }

            function updateSongListHighlight() {
                document.querySelectorAll('.song-item').forEach(item => {
                    item.classList.remove('active');
                    const index = parseInt(item.dataset.index);
                    if (currentSong && songs[index] &&
                        songs[index].title === currentSong.title &&
                        songs[index].artist === currentSong.artist) {
                        item.classList.add('active');
                    }
                });
            }
            // ‰øÆÊîπminiÊí≠ÊîæÂô®ÁöÑÁÇπÂáª‰∫ã‰ª∂Â§ÑÁêÜ
            miniPlayer.addEventListener('click', function (e) {
                if (!e.target.closest('.mini-player-controls')) {
                    if (!currentSong) return;
                    // Êõ¥Êñ∞È°µÈù¢Áä∂ÊÄ?                    isPlayerPageActive = true;
                    homePage.style.display = 'none';
                    searchPage.style.display = 'none';
                    playerPage.style.display = 'block';
                    localMusicPage.style.display = 'none';
                    playlistDetailPage.style.display = 'none'; // Êñ∞Â¢ûÔºöÈöêËóèÊ≠åÂçïËØ¶ÊÉÖÈ°µ
                    // Êõ¥Êñ∞tabÁä∂ÊÄ?                    homeTab.classList.remove('active');
                    searchTab.classList.remove('active');
                    localTab.classList.remove('active');
                    playerTab.classList.add('active');
                    updateMiniPlayerVisibility();
                }
            });
            // Âú®ÊöÇÂÅúÊó∂ÂÅúÊ≠¢Âä®Áîª
            audioPlayer.addEventListener('pause', function () {
                isPlaying = false;
                updatePlayPauseButtons();
                const searchTab = document.querySelector('.search-tab');
                const localTab = document.querySelector('.local-tab');
                const tabMusic = document.querySelector('.tab-music');
                // tabMusic.style.animationPlayState = 'paused'; // ÊöÇÂÅúÂä®Áîª
                //searchTab.style.animationPlayState = 'paused'; // ÊöÇÂÅúÂä®Áîª
                //localTab.style.animationPlayState = 'paused'; // ÊöÇÂÅúÂä®Áîª
                // 5ÁßíÂêéÂàáÊç¢Âà∞ÂπøÂëäÊ®°Âº?                //adTimeout = setTimeout(() => {
                //switchToAdMode();
                //}, 500);
            });
            // Âú®Êí≠ÊîæÊó∂ÂêØÂä®Âä®Áîª
            audioPlayer.addEventListener('play', function () {
                isPlaying = true;
                updatePlayPauseButtons();
                updateLyricsHighlight();
                // ÈáçÊñ∞ËÆæÁΩÆ30ÁßíÂπøÂëäÂàáÊç¢ÂÆöÊó∂Âô®
                //clearInterval(adSwitchInterval);
                //adSwitchInterval = setInterval(() => {
                //if (isPlaying) {
                //switchToAdMode();
                // 5ÁßíÂêéËá™Âä®ÊÅ¢Â§çÊí≠Êîæ
                //setTimeout(() => {
                //if (!isPlaying) {
                //audioPlayer.play().catch(e => console.log('ÊÅ¢Â§çÊí≠ÊîæÂ§±Ë¥•:', e));
                //}
                //}, 5000);
                //}
                //}, AD_SWITCH_INTERVAL);
                const searchTab = document.querySelector('.search-tab');
                const localTab = document.querySelector('.local-tab');
                const tabMusic = document.querySelector('.tab-music');
                tabMusic.style.animationPlayState = 'running'; // ÂêØÂä®Âä®Áîª
                searchTab.style.animationPlayState = 'running'; // ÂêØÂä®Âä®Áîª
                localTab.style.animationPlayState = 'running'; // ÂêØÂä®Âä®Áîª
                switchToPlayingMode();
            });
            // Âú®Êí≠ÊîæÁªìÊùüÊó∂ÊöÇÂÅúÂä®Áîª
            audioPlayer.addEventListener('ended', function () {
                if (isRepeat) {
                    audioPlayer.currentTime = 0;
                    audioPlayer.play();
                } else {
                    playNextSong();
                }
                const searchTab = document.querySelector('.search-tab');
                const localTab = document.querySelector('.local-tab');
                const tabMusic = document.querySelector('.tab-music');
                if (!isRepeat) {
                    tabMusic.style.animationPlayState = 'paused'; // Â¶ÇÊûú‰∏çÈáçÂ§çÊí≠ÊîæÂàôÊöÇÂÅúÂä®Áîª„Ä?                    searchTab.style.animationPlayState = 'paused';
                    localTab.style.animationPlayState = 'paused';
                }
            });
            // Âú®È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂå?            document.addEventListener('DOMContentLoaded', function () {
                // Ê∑ªÂä†ËÉåÊôØÂÆπÂô®ÂàùÂßãÂå?                const bgImage = document.getElementById('music-bg-image');
                bgImage.style.backgroundImage = 'none';
                // ÂàùÂßãÂåñÈ°µÈù¢Áä∂ÊÄ?                initializePageState();
            });
            // Êô∫ËÉΩËäÇÊµÅÂáΩÊï∞ÔºàËá™Âä®Âª∂ÈïøÈó¥ÈöîÂΩìÈ°µÈù¢‰∏çÂèØËßÅÊó∂Ôº?            function smartThrottle(func, baseInterval) {
                let lastRun = 0;
                let timeoutId;
                return Object.assign(
                    (...args) => {
                        const now = Date.now();
                        const visible = document.visibilityState === 'visible';
                        const interval = visible ? baseInterval : baseInterval * 3;
                        if (now - lastRun >= interval) {
                            func(...args);
                            lastRun
                                = now;
                        } else if (!timeoutId) {
                            timeoutId
                                = setTimeout(() => {
                                    func(...args);
                                    lastRun
                                        = Date.now();
                                    timeoutId
                                        = null;
                                }, interval - (now - lastRun));
                        }
                    }, {
                    cancel: () => clearTimeout(timeoutId)
                }
                );
            }
            // ÂÖ®Â±ÄÁºìÂ≠òÂØπË±°
            const playlistCache = {
                data: {},
                lastUpdated: {},
                expiryTime: 3600000 // 1Â∞èÊó∂ÁºìÂ≠òÊó∂Èó¥(ÊØ´Áßí)
            };
            // ÊòæÁ§∫Ê≠åÂçïËØ¶ÊÉÖÈ°?            function showPlaylistDetail(playlist) {
                // ÈöêËóèÂÖ∂‰ªñÈ°µÈù¢
                homePage.style.display = 'none';
                searchPage.style.display = 'none';
                playerPage.style.display = 'none';
                localMusicPage.style.display = 'none';
                playlistDetailPage.style.display = 'block';
                // Êõ¥Êñ∞Ê≠åÂçï‰ø°ÊÅØ
                playlistCover.src = playlist.covers[0] || 'favicon.png';
                playlistTitle.textContent = playlist.name;
                playlistDescription.textContent = playlist.description || 'ÊöÇÊó†ÁÆÄ‰ª?;
                // ËÆæÁΩÆÂΩìÂâçÊ≠åÂçïID
                playlistDetailPage.dataset.currentPlaylistId = playlist.id;
                // Âä†ËΩΩÊ≠åÂçïÊ≠åÊõ≤
                loadPlaylistSongs(playlist.id);
            }
            // ‰øÆÊîπÂêéÁöÑÂä†ËΩΩÊ≠åÂçïÂáΩÊï∞
            async function loadPlaylistSongs(playlistId) {
                // Ê£ÄÊü•ÁºìÂ≠òÊòØÂê¶Â≠òÂú®‰∏îÊú™ËøáÊú?                const now = Date.now();
                if (playlistCache.data[playlistId] &&
                    now - (playlistCache.lastUpdated[playlistId] || 0) < playlistCache.expiryTime) {
                    displayCachedPlaylist(playlistId);
                    return;
                }
                try {
                    // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄ?                    playlistSongs.innerHTML = '<div class="loading">Âä†ËΩΩ‰∏?..</div>';
                    const keyword = getKeywordByPlaylistId(playlistId);
                    const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=&type=json&msg=${encodeURIComponent(keyword)}`);
                    const result = await response.json();
                    // Á°Æ‰øùresult.dataÂ≠òÂú®‰∏îÊòØÊï∞ÁªÑ
                    if (result.code === 200 && Array.isArray(result.data)) {
                        // Á°Æ‰øùÊúÄÂ§öÂè™Âè?0È¶?                        const finalSongs = result.data.slice ? result.data.slice(0, 50) : [];
                        // Êõ¥Êñ∞ÁºìÂ≠ò
                        playlistCache.data[playlistId] = finalSongs;
                        playlistCache.lastUpdated[playlistId] = now;
                        // ÊòæÁ§∫Ê≠åÊõ≤ÂàóË°®
                        displayPlaylistSongs(finalSongs);
                        playlistSongCount.textContent = `${finalSongs.length} È¶ñÊ≠åÊõ≤`;
                    } else {
                        throw new Error('ËøîÂõûÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°?);
                    }
                } catch (error) {
                    console.error('Âä†ËΩΩÊ≠åÂçïÊ≠åÊõ≤Â§±Ë¥•:', error);
                    showErrorOrFallback(playlistId);
                }
            }
            // ÊòæÁ§∫ÁºìÂ≠òÊï∞ÊçÆ
            function displayCachedPlaylist(playlistId) {
                const cachedData = playlistCache.data[playlistId];
                if (cachedData) {
                    playlistSongCount.textContent = `${cachedData.length} È¶ñÊ≠åÊõ≤`;
                    displayPlaylistSongs(cachedData);
                }
            }
            // Ëé∑ÂèñÂÖ≥ÈîÆËØçÁöÑËæÖÂä©ÂáΩÊï∞
            function getKeywordByPlaylistId(playlistId) {
                const playlist = playlists.find(p => p.id === playlistId);
                return playlist ? playlist.keyword : 'ÊµÅË°å'; // ÈªòËÆ§ËøîÂõû "ÊµÅË°å"ÔºàÂ¶ÇÊûúÊ≤°ÊúâÂåπÈÖçÔºâ
            }
            // ÂàÜÊâπÂä†ËΩΩËÆæÁΩÆ
            const BATCH_SIZE = 10; // ÊØèÊâπÂä†ËΩΩ10È¶?            let currentBatch = 0;
            let scrollObserver = null;
            // ÊòæÁ§∫Ê≠åÊõ≤ÂàóË°®
            async function displayPlaylistSongs(songList) {
                // ÈáçÁΩÆÊâπÊ¨°
                currentBatch = 0;
                // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
                playlistSongs.innerHTML = '';
                // Â≠òÂÇ®ÂÆåÊï¥ÂàóË°®‰æõÂêéÁª≠‰ΩøÁî?                playlistSongs.dataset.fullList = JSON.stringify(songList);
                // Âä†ËΩΩÁ¨¨‰∏ÄÊâ?                await loadNextBatch();
                // ËÆæÁΩÆÊªöÂä®ÁõëÂê¨ÔºàÂÖàÁßªÈô§ÊóßÁöÑÔº?                if (scrollObserver) {
                    scrollObserver.disconnect();
                }
                scrollObserver = new IntersectionObserver(handleScroll, {
                    root: playlistSongs,
                    threshold: 0.1
                });
                // ËßÇÂØüÊúÄÂêé‰∏Ä‰∏™ÂÖÉÁ¥?                if (playlistSongs.lastChild) {
                    scrollObserver.observe(playlistSongs.lastChild);
                }
            }
            // Âä†ËΩΩ‰∏ã‰∏ÄÊâπÊ≠åÊõ?            async function loadNextBatch() {
                const fullList = JSON.parse(playlistSongs.dataset.fullList || '[]');
                const start = currentBatch * BATCH_SIZE;
                const end = start + BATCH_SIZE;
                const batch = fullList.slice(start, end);
                if (batch.length === 0) return;
                // ÊòæÁ§∫Âä†ËΩΩÊåáÁ§∫Âô?                if (currentBatch > 0) {
                    const loader = document.createElement('div');
                    loader.className = 'batch-loader';
                    loader.innerHTML = '<div class="loading-spinner"></div><span>Âä†ËΩΩÊõ¥Â§ö...</span>';
                    playlistSongs.appendChild(loader);
                }
                // Ëé∑ÂèñÊ≠åÊõ≤ËØ¶ÊÉÖ
                const songsWithDetails = await getBatchDetails(batch, start);
                // ÁßªÈô§Âä†ËΩΩÊåáÁ§∫Âô?                const loader = playlistSongs.querySelector('.batch-loader');
                if (loader) loader.remove();
                // Ê∏≤ÊüìÂΩìÂâçÊâπÊ¨°
                renderSongBatch(songsWithDetails, start);
                currentBatch++;
                // Êõ¥Êñ∞ÊªöÂä®ËßÇÂØüÂô?                if (scrollObserver && playlistSongs.lastChild) {
                    scrollObserver.observe(playlistSongs.lastChild);
                }
            }
            // ÊªöÂä®Â§ÑÁêÜ
            function handleScroll(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.target === playlistSongs.lastChild) {
                        loadNextBatch();
                    }
                });
            }
            // Ëé∑ÂèñÊâπÊ¨°Ê≠åÊõ≤ËØ¶ÊÉÖ
            async function getBatchDetails(batch, startIndex) {
                const detailPromises = batch.map(async (song, index) => {
                    try {
                        const details = await getSongDetails(startIndex + index + 1, song.song_title);
                        return {
                            ...song,
                            ...details,
                            title: details.title || song.song_title,
                            artist: details.artist || song.song_singer,
                            image: details.image || song.cover || song.pic || 'favicon.png'
                        };
                    } catch (error) {
                        console.error(`Ëé∑ÂèñÊ≠åÊõ≤„Ä?{song.song_title}„ÄãËØ¶ÊÉÖÂ§±Ë¥?`, error);
                        return song;
                    }
                });
                return await Promise.all(detailPromises);
            }
            // Ê∏≤ÊüìÊ≠åÊõ≤ÊâπÊ¨°
            function renderSongBatch(songs, startIndex) {
                const fragment = document.createDocumentFragment();
                songs.forEach((song, index) => {
                    const globalIndex = startIndex + index;
                    const songElement = document.createElement('div');
                    songElement.className = 'song-item';
                    songElement.dataset.index = globalIndex;
                    songElement.innerHTML = `
            <div class="song-number">${globalIndex + 1}</div>

            <div class="song-info">
                <div class="song-title">${song.song_title || 'Êú™Áü•Ê≠åÊõ≤'}</div>
                <div class="song-artist">${song.song_singer || 'Êú™Áü•Ê≠åÊâã'}</div>
            </div>
            <div class="song-quality">${song.quality || 'HQÈ´òÂìÅ'}</div>
        `;
                    songElement.addEventListener('click', () => {
                        const fullList = JSON.parse(playlistSongs.dataset.fullList || '[]');
                        songs = fullList;
                        currentSongIndex = globalIndex;
                        currentSong = song;
                        playSong(song);
                    });
                    fragment.appendChild(songElement);
                });
                playlistSongs.appendChild(fragment);
                // ÊáíÂä†ËΩΩÂõæÁâ?                lazyLoadImages();
            }
            // ÂõæÁâáÊáíÂä†ËΩ?            function lazyLoadImages() {
                const imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            img.src = img.dataset.src;
                            img.onload = () => img.classList.add('loaded');
                            imageObserver.unobserve(img);
                        }
                    });
                }, {
                    root: playlistSongs
                });
                document.querySelectorAll('.song-cover:not([src])').forEach(img => {
                    imageObserver.observe(img);
                });
            }
            // Ëá™Âä®Êõ¥Êñ∞Êú∫Âà∂
            function setupAutoRefresh() {
                setInterval(() => {
                    const now = Date.now();
                    Object.keys(playlistCache.lastUpdated).forEach(playlistId => {
                        if (now - playlistCache.lastUpdated[playlistId] >= playlistCache.expiryTime) {
                            refreshPlaylistInBackground(playlistId);
                        }
                    });
                }, 3600000); // ÊØèÂ∞èÊó∂Ê£ÄÊü•‰∏ÄÊ¨?            }
            // ÂêéÂè∞ÈùôÈªòÊõ¥Êñ∞
            async function refreshPlaylistInBackground(playlistId) {
                try {
                    const keyword = getKeywordByPlaylistId(playlistId);
                    const response = await fetch(`https://sdkapi.hhlqilongzhu.cn/api/QQmusic/?key=Dragon652C2277C78812D1B1ED2C5D087D9053&n=&type=json&msg=${encodeURIComponent(keyword)}`);
                    const result = await response.json();
                    if (result.code === 200 && result.data) {
                        // Á°Æ‰øùÊúÄÂ§öÂè™Âè?0È¶?                        const finalSongs = result.data.slice ? result.data.slice(0, 50) : [];
                        playlistCache.data[playlistId] = finalSongs;
                        playlistCache.lastUpdated[playlistId] = Date.now();
                        // Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®Êü•ÁúãËøô‰∏™Ê≠åÂçïÔºåÂàôÊõ¥Êñ∞UI
                        if (playlistDetailPage.style.display === 'block' &&
                            playlistDetailPage.dataset.currentPlaylistId === playlistId) {
                            playlistSongCount.textContent = `${finalSongs.length} È¶ñÊ≠åÊõ≤`;
                            displayPlaylistSongs(finalSongs);
                        }
                    }
                } catch (error) {
                    console.error(`ÂêéÂè∞Êõ¥Êñ∞Ê≠åÂçï ${playlistId} Â§±Ë¥•:`, error);
                }
            }
            // ÈîôËØØÂ§ÑÁêÜÂíåÂõûÈÄÄ
            function showErrorOrFallback(playlistId) {
                if (playlistCache.data[playlistId]) {
                    // ÊòæÁ§∫ÁºìÂ≠òÊï∞ÊçÆÂπ∂ÊèêÁ§?                    displayCachedPlaylist(playlistId);
                    showToast('ÁΩëÁªúÂºÇÂ∏∏ÔºåÊòæÁ§∫ÁºìÂ≠òÊï∞Êç?);
                } else {
                    playlistSongs.innerHTML = `
            <div class="empty-state">
                <i class="icon-error"></i>
                <p>Âä†ËΩΩÊ≠åÂçïÊ≠åÊõ≤Â§±Ë¥•</p>
                <button class="retry-btn" onclick="loadPlaylistSongs('${playlistId}')">ÈáçËØï</button>
            </div>
        `;
                }
            }
            // ÂàùÂßãÂåñËá™Âä®Êõ¥Êñ?            setupAutoRefresh();
            // playAllBtnÁöÑÁÇπÂáª‰∫ã‰ª∂Â§ÑÁê?            playAllBtn.addEventListener('click', () => {
                const songElements = playlistSongs.querySelectorAll('.song-item');
                if (songElements.length > 0) {
                    // Ëé∑ÂèñÊ≠åÂçï‰∏≠ÁöÑÊâÄÊúâÊ≠åÊõ?                    songs = Array.from(songElements).map(el => {
                        const title = el.querySelector('.song-title').textContent;
                        const artist = el.querySelector('.song-artist').textContent;
                        const image = el.querySelector('.song-cover').src;
                        const quality = el.querySelector('.song-quality').textContent;
                        return {
                            title,
                            artist,
                            image,
                            quality
                        };
                    });
                    // ‰ªéÁ¨¨‰∏ÄÈ¶ñÊ≠åÂºÄÂßãÊí≠Êî?                    currentSongIndex = 0;
                    currentSong = songs[0];
                    // ÂºÄÂßãÊí≠Êî?                    playSong(currentSong);
                    // Â¶ÇÊûú‰∏çÂú®Êí≠ÊîæÂô®È°µÈù¢ÔºåÂàáÊç¢Âà∞Êí≠ÊîæÂô®È°µÈù¢
                    if (!isPlayerPageActive) {
                        isPlayerPageActive = true;
                        homePage.style.display = 'none';
                        searchPage.style.display = 'none';
                        playerPage.style.display = 'block';
                        localMusicPage.style.display = 'none';
                        playlistDetailPage.style.display = 'none';
                        // Êõ¥Êñ∞tabÁä∂ÊÄ?                        homeTab.classList.remove('active');
                        searchTab.classList.remove('active');
                        localTab.classList.remove('active');
                        playerTab.classList.add('active');
                        // Êõ¥Êñ∞miniÊí≠ÊîæÂô®ÊòæÁ§∫Áä∂ÊÄ?                        updateMiniPlayerVisibility();
                    }
                    webapp.toast('ÂºÄÂßãÊí≠ÊîæÂÖ®ÈÉ®Ê≠åÊõ?);
                } else {
                    webapp.toast('Ê≠åÂçï‰∏≠Ê≤°ÊúâÊ≠åÊõ?);
                }
            });
            // ËøîÂõûÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            document.getElementById('back-to-home').addEventListener('click', () => {
                // ÈöêËóèÊ≠åÂçïËØ¶ÊÉÖÈ°?                playlistDetailPage.style.display = 'none';
                // ÊòæÁ§∫È¶ñÈ°µ
                homePage.style.display = 'block';
                // Êõ¥Êñ∞tabÁä∂ÊÄ?                searchTab.classList.remove('active');
                localTab.classList.remove('active');
                playerTab.classList.remove('active');
                homeTab.classList.add('active');
            });
            // ÁºìÂ≠òÂ∞ÅÈù¢Êï∞ÊçÆÔºåÈÅøÂÖçÈáçÂ§çËØ∑Ê±?            const coverCache = new Map();
            // Ëé∑ÂèñÁÉ≠ÊêúÊ¶úÊï∞Êç?            async function getHotSearchData(chartId = 1) {
                try {
                    const cacheKey = `chart-${chartId}`;
                    // Ê£ÄÊü•ÁºìÂ≠ò‰∏≠ÊòØÂê¶ÊúâÊï∞Êç?                    if (sessionStorage.getItem(cacheKey)) {
                        return JSON.parse(sessionStorage.getItem(cacheKey));
                    }
                    const response = await fetch(`https://api.dragonlongzhu.cn/api/dg_QQphb.php?id=${chartId}&type=`);
                    const data = await response.json();
                    const result = data.data || [];
                    // ÁºìÂ≠òÊï∞ÊçÆ
                    sessionStorage.setItem(cacheKey, JSON.stringify(result));
                    return result;
                } catch (error) {
                    console.error('Ëé∑ÂèñÊ¶úÂçïÊï∞ÊçÆÂ§±Ë¥•:', error);
                    return [];
                }
            }
            // Ëé∑ÂèñÊ≠åÊõ≤Â∞ÅÈù¢ÔºàÊâπÈáèÂ§ÑÁêÜÔºâ
            async function getBatchSongCovers(data, chartId) {
                try {
                    // Ê£ÄÊü•ÁºìÂ≠ò‰∏≠ÊòØÂê¶Â∑≤ÊúâÂ∞ÅÈù¢Êï∞ÊçÆ
                    const cachedItems = data.filter(item => coverCache.has(`${chartId}-${item.title}`));
                    if (cachedItems.length === data.length) {
                        return data.map(item => ({
                            ...item,
                            cover: coverCache.get(`${chartId}-${item.title}`) || 'favicon.png'
                        }));
                    }
                    // ÊâπÈáèËé∑ÂèñÂ∞ÅÈù¢
                    const response = await fetch(`https://api.dragonlongzhu.cn/api/dg_QQphb.php?id=${chartId}&type=json`);
                    const result = await response.json();
                    if (result.code === 200) {
                        // Êõ¥Êñ∞ÁºìÂ≠ò
                        data.forEach((item, index) => {
                            const cover = result.song_cover || 'favicon.png';
                            coverCache.set(`${chartId}-${item.title}`, cover);
                        });
                    }
                    return data.map(item => ({
                        ...item,
                        cover: coverCache.get(`${chartId}-${item.title}`) || 'favicon.png'
                    }));
                } catch (error) {
                    return data.map(item => ({
                        ...item,
                        cover: 'favicon.png'
                    }));
                }
            }
            // Âä†ËΩΩÁÉ≠ÊêúÊ¶úÊï∞Êç?            async function loadHotSearchData(chartId = 1) {
                const hotSearchSection = document.getElementById('hot-search-section');
                const searchResultSection = document.getElementById('search-result-section');
                const hotSearchList = document.getElementById('hot-search-list');
                try {
                    // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄ?                    hotSearchList.innerHTML = '<div class="loading-state">Âä†ËΩΩ‰∏?..</div>';
                    // ÂàáÊç¢ÊòæÁ§∫Áä∂ÊÄ?                    hotSearchSection.style.display = 'block';
                    searchResultSection.style.display = 'none';
                    // Ëé∑ÂèñÊï∞ÊçÆÂπ∂ÊòæÁ§?                    const data = await getHotSearchData(chartId);
                    if (data && data.length > 0) {
                        // Âè™ÊòæÁ§∫Ââç30Êù°Ôºå‰ΩÜÂÖàÊòæÁ§∫Â∑≤ÊúâÊï∞ÊçÆÔºåÂ∞ÅÈù¢ÂºÇÊ≠•Âä†ËΩ?                        const itemsToShow = data.slice(0, 30);
                        await displayHotSearchItems(itemsToShow, chartId);
                    } else {
                        hotSearchList.innerHTML = '<div class="empty-state">ÊöÇÊó†Êï∞ÊçÆ</div>';
                    }
                } catch (error) {
                    console.error('Âä†ËΩΩÊ¶úÂçïÂ§±Ë¥•:', error);
                    hotSearchList.innerHTML = '<div class="empty-state">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï</div>';
                }
            }
            // ÊòæÁ§∫ÁÉ≠ÊêúÊ¶úÂàóË°®Ôºà‰ºòÂåñÁâàÔºâ
            async function displayHotSearchItems(data, chartId) {
                const hotSearchList = document.getElementById('hot-search-list');
                // ÂÖàÊ∏≤ÊüìÂü∫Êú¨ÁªìÊû?                hotSearchList.innerHTML = data.map((item, index) => `
        <div class="hot-search-item ${index < 10 ? 'top10' : ''} chart-${chartId}" data-index="${index}">
            <div class="hot-search-rank">${index + 1}</div>
            <div class="hot-search-content">
                <div class="hot-search-title">${item.title}</div>
                <div class="hot-search-desc">${item.singer}</div>
            </div>
        </div>
    `).join('');
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Ôºà‰∫ã‰ª∂ÂßîÊâòÔºâ
                hotSearchList.addEventListener('click', (e) => {
                    const item = e.target.closest('.hot-search-item');
                    if (item) {
                        const index = parseInt(item.dataset.index);
                        const searchInput = document.getElementById('search-input');
                        searchInput.value = `${data[index].title} ${data[index].singer}`;
                        searchSongs();
                    }
                });
            }
            // Ê∑ªÂä†Ê¶úÂçïÂàáÊç¢‰∫ã‰ª∂ÁõëÂê¨Ôºà‰ºòÂåñÁâàÔº?            document.addEventListener('DOMContentLoaded', function () {
                const chartNav = document.querySelector('.chart-nav');
                if (chartNav) {
                    // ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâò
                    chartNav.addEventListener('click', (e) => {
                        const btn = e.target.closest('.chart-nav-btn');
                        if (btn) {
                            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄ?                            chartNav.querySelectorAll('.chart-nav-btn').forEach(b => b.classList.remove('active'));
                            btn.classList.add('active');
                            // Âä†ËΩΩÂØπÂ∫îÊ¶úÂçïÊï∞ÊçÆ
                            const chartId = btn.dataset.id;
                            loadHotSearchData(chartId);
                        }
                    });
                    // ÈªòËÆ§Âä†ËΩΩÁ¨¨‰∏Ä‰∏™Ê¶úÂç?                    const defaultBtn = chartNav.querySelector('.chart-nav-btn.active') ||
                        chartNav.querySelector('.chart-nav-btn');
                    if (defaultBtn) {
                        loadHotSearchData(defaultBtn.dataset.id);
                    }
                }
            });;
            // Ê∑ªÂä†Âà∑Êñ∞ÊåâÈíÆÁöÑ‰∫ã‰ª∂ÁõëÂê?            document.getElementById('refresh-trending').addEventListener('click', () => {
                const keyword = searchInput.value.trim();
                if (keyword) {
                    searchSongs();
                }
            });
            // ËøûÊé•‰∏ªÊí≠ÊîæÂô®ÂíåtabÊí≠ÊîæÂô?            connectTabPlayer();
            // ËøûÊé•‰∏ªÊí≠ÊîæÂô®ÂíåtabÊí≠ÊîæÂô?            function connectTabPlayer() {
                // ÂêåÊ≠•Êí≠ÊîæÁä∂ÊÄ?                audioPlayer.addEventListener('play', updateTabPlayer);
                audioPlayer.addEventListener('pause', updateTabPlayer);
                audioPlayer.addEventListener('ended', updateTabPlayer);
                audioPlayer.addEventListener('timeupdate', updateTabPlayer);
                // ÂêåÊ≠•Ê≠åÊõ≤ÂèòÂåñ
                audioPlayer.addEventListener('loadedmetadata', updateTabPlayer);
                // ÊåâÈíÆ‰∫ã‰ª∂
                tabPlayBtn.addEventListener('click', togglePlayPause);
                tabPrevBtn.addEventListener('click', playPreviousSong);
                tabNextBtn.addEventListener('click', playNextSong);
                // ÂàùÂßãÊõ¥Êñ∞
                updateTabPlayer();
            }
            // Êõ¥Êñ∞tabÊí≠ÊîæÂô®Áä∂ÊÄ?            function updateTabPlayer() {
                if (currentSong) {
                    // Êõ¥Êñ∞Ê≠åÊõ≤‰ø°ÊÅØ
                    tabTitle.textContent = currentSong.title;
                    tabArtist.textContent = currentSong.artist;
                    // Êõ¥Êñ∞ËÉåÊôØÂõæÁâá
                    if (currentSong.image) {
                        tabBgImage.style.backgroundImage = `url(${currentSong.image})`;
                        tabBgImage.classList.add('active');
                    } else {
                        tabBgImage.classList.remove('active');
                    }
                    // Êõ¥Êñ∞Êí≠ÊîæÊåâÈíÆÁä∂ÊÄ?                    if (isPlaying) {
                        tabPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    } else {
                        tabPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                }
            }
            // Êú¨Âú∞Èü≥‰πêÊâ´ÊèèÂíåÁÆ°ÁêÜÂäüËÉ?            let isScanning = false;
            let scanPaused = false;
            let cancelRequested = false;
            let localSongs = [];
            let currentScanDir = '';
            let totalFilesScanned = 0;
            const supportedFormats = [
                '.mp3', '.m4a', '.flac', '.wav', '.ogg',
                '.aac', '.opus', '.wma', '.amr', '.mid',
                '.midi', '.imy', '.mp4', '.m4b', '.m4p',
                '.3gp', '.3gpp', '.3g2'
            ];
            const musicAppPaths = {
                'HillMusic': '/storage/emulated/0/HillMusic/song',
                'ÁΩëÊòì‰∫ëÈü≥‰π?: '/storage/emulated/0/netease/cloudmusic/Music/',
                'ÈÖ∑ÁãóÈü≥‰πê': '/storage/emulated/0/kgmusic/download/',
                'ÈÖ∑ÊàëÈü≥‰πê': '/storage/emulated/0/KwDownload/download/',
                'QQÈü≥‰πê': '/storage/emulated/0/qqmusic/song',
                'Âí™ÂíïÈü≥‰πê': '/storage/emulated/0/migu/mp3/',
                'Download': '/storage/emulated/0/Download/',
                'Èü≥‰πê': '/storage/emulated/0/Music/'
            };
            let scanStats = {};
            // ÂàùÂßãÂåñÊú¨Âú∞Èü≥‰πêÂäüËÉ?            function initLocalMusic() {
                loadLocalSongs();
                setupEventListeners();
            }

            function setupEventListeners() {
                // Êâ´ÊèèÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
                document.getElementById('scan-toggle-btn').addEventListener('click', handleScanToggle);
                // Êú¨Âú∞Èü≥‰πêÊêúÁ¥¢
                document.getElementById('local-search-input').addEventListener('input', debounce(handleLocalSearch, 300));
            }

            function handleScanToggle() {
                const btn = document.getElementById('scan-toggle-btn');
                const progress = document.getElementById('scan-progress');
                if (!isScanning && !scanPaused) {
                    // ÂºÄÂßãÊâ´Êè?                    // Ê£ÄÊü•Â≠òÂÇ®ÊùÉÈô?                    if (!webapp.bestow()) {
                        webapp.rights(); // ËØ∑Ê±ÇÂ≠òÂÇ®ÊùÉÈôê
                        webapp.toast('ËØ∑ÂÖàÊéà‰∫àÂ≠òÂÇ®ÊùÉÈôê');
                        return;
                    }
                    startScanning(btn, progress);
                    webapp.toast('Ê≠£Âú®Êâ´ÊèèÔºåËØ∑Á®çÁ≠â');
                } else if (isScanning) {
                    // ÂÅúÊ≠¢Êâ´Êèè
                    stopScanning(btn, progress);
                } else if (scanPaused) {
                    // ÁªßÁª≠Êâ´Êèè
                    resumeScanning(btn, progress);
                }
            }
            const btn = document.getElementById('scan-toggle-btn');
            async function startScanning(btn, progress) {
                console.log('ÂºÄÂßãÊâ´ÊèèÊú¨Âú∞Èü≥‰π?..');
                cancelRequested = false;
                isScanning = true;
                scanPaused = false;
                btn.innerHTML = `<i class="fas fa-stop"></i> ÂÅúÊ≠¢Êâ´Êèè`;
                progress.style.display = 'block';
                progress.querySelector('#scan-status-text').textContent = 'Ê≠£Âú®Êâ´Êèè...';
                // Ê∏ÖÁ©∫Áé∞ÊúâÂàóË°®
                localSongs = [];
                updateLocalMusicListUI();
                // Âü∫Êú¨Áî®Ê≥ï
                const result = await scanAndRemoveInvalidSongs();
                console.log(`ÁßªÈô§‰∫?${result.removedCount} È¶ñÊó†ÊïàÊ≠åÊõ≤`);
                // ‰∏çÊõ¥Êñ∞Êí≠ÊîæÂô®Áä∂ÊÄÅÂíå‰∏ç‰øùÂ≠òÂà∞Â≠òÂÇ®
                await scanAndRemoveInvalidSongs(false, false);
                try {
                    await scanMusicFiles();
                    const uniqueSongs = Array.from(new Map(localSongs.map(song => [song.path, song])).values());
                    localSongs = uniqueSongs;
                    saveLocalSongs();
                    updateLocalMusicListUI();
                    progress.querySelector('#scan-status-text').textContent = `Êâ´ÊèèÂÆåÊàêÔºåÂÖ±ÊâæÂà∞ ${localSongs.length} È¶ñÊ≠åÊõ≤`;
                    progress.querySelector('.scan-spinner').style.display = 'none';
                } catch (error) {
                    console.error('Êâ´ÊèèÂ§±Ë¥•:', error);
                    webapp.toast('Êâ´ÊèèÂ§±Ë¥•: ' + error.message);
                } finally {
                    isScanning = false;
                    btn.innerHTML = `<i class="fas fa-sync-alt"></i> ÈáçÊñ∞Êâ´Êèè`;
                }
            }

            function stopScanning(btn, progress) {
                console.log('Áî®Êà∑ËØ∑Ê±ÇÂÅúÊ≠¢Êâ´Êèè...');
                cancelRequested = true;
                isScanning = false;
                scanPaused = true;
                btn.innerHTML = `<i class="fas fa-play"></i> ÁªßÁª≠Êâ´Êèè`;
                progress.querySelector('#scan-status-text').textContent = `Â∑≤ÊöÇÂÅúÊâ´ÊèèÔºåÂ∑≤ÊâæÂà?${localSongs.length} È¶ñÊ≠åÊõ≤`;
                progress.querySelector('.scan-spinner').style.display = 'none';
            }
            async function resumeScanning(btn, progress) {
                console.log('ÁªßÁª≠Êâ´Êèè...');
                cancelRequested = false;
                isScanning = true;
                scanPaused = false;
                btn.innerHTML = `<i class="fas fa-stop"></i> ÂÅúÊ≠¢Êâ´Êèè`;
                progress.querySelector('#scan-status-text').textContent = 'ÁªßÁª≠Êâ´Êèè...';
                progress.querySelector('.scan-spinner').style.display = 'block';
                try {
                    await scanMusicFiles();
                    const uniqueSongs = Array.from(new Map(localSongs.map(song => [song.path, song])).values());
                    localSongs = [...uniqueSongs];
                    saveLocalSongs();
                    updateLocalMusicListUI();
                    if (!cancelRequested) {
                        progress.querySelector('#scan-status-text').textContent = `Êâ´ÊèèÂÆåÊàêÔºåÂÖ±ÊâæÂà∞ ${localSongs.length} È¶ñÊ≠åÊõ≤`;
                        progress.querySelector('.scan-spinner').style.display = 'none';
                        btn.innerHTML = `<i class="fas fa-sync-alt"></i> ÈáçÊñ∞Êâ´Êèè`;
                    }
                } catch (error) {
                    console.error('ÁªßÁª≠Êâ´ÊèèÂ§±Ë¥•:', error);
                    webapp.toast('ÁªßÁª≠Êâ´ÊèèÂ§±Ë¥•: ' + error.message);
                }
            }
            async function scanMusicFiles() {
                if (!isScanning) return;
                console.log('ÂàùÂßãÂåñÊâ´ÊèèÁªüËÆ?..');
                scanStats = Object.keys(musicAppPaths).reduce((acc, key) => {
                    acc[key] = 0;
                    return acc;
                }, {});
                totalFilesScanned = 0;
                const progress = document.getElementById('scan-progress');
                const statusText = progress.querySelector('#scan-status-text');
                const progressBar = progress.querySelector('#scan-progress-bar');
                try {
                    const apps = Object.entries(musicAppPaths);
                    for (let i = 0; i < apps.length; i++) {
                        if (!isScanning || cancelRequested) break;
                        const [appName, dirPath] = apps[i];
                        currentScanDir = dirPath;
                        console.log(`ÂºÄÂßãÊâ´Êè?${appName} ÁõÆÂΩï: ${dirPath}`);
                        statusText.textContent = `Ê≠£Âú®Êâ´Êèè ${appName} ÁõÆÂΩï...`;
                        progressBar.style.width = `${(i / apps.length) * 100}%`;
                        // Ê£ÄÊü•ÁõÆÂΩïÊòØÂê¶Â≠òÂú?                        try {
                            const dirExists = webapp.listfile(dirPath) !== "null";
                            console.log(`ÁõÆÂΩï ${dirPath} ÊòØÂê¶Â≠òÂú®:`, dirExists);
                            if (dirExists) {
                                await scanDirectory(dirPath, appName);
                            } else {
                                console.log(`Ë∑≥Ëøá‰∏çÂ≠òÂú®ÁöÑÁõÆÂΩï: ${dirPath}`);
                            }
                        } catch (dirError) {
                            console.error(`Êâ´ÊèèÁõÆÂΩï ${dirPath} Âá∫Èîô:`, dirError);
                            continue;
                        }
                    }
                    if (!cancelRequested) {
                        const total = Object.values(scanStats).reduce((a, b) => a + b, 0);
                        console.log('Êâ´ÊèèÂÆåÊàêÔºåÁªüËÆ°ÁªìÊû?', scanStats);
                        console.log('ÊÄªÂÖ±ÊâæÂà∞Èü≥‰πêÊñá‰ª∂:', total);
                        statusText.textContent = `Êâ´ÊèèÂÆåÊàêÔºåÂÖ±ÊâæÂà∞ ${total} È¶ñÊ≠åÊõ≤`;
                        progressBar.style.width = '100%';
                    }
                } catch (error) {
                    console.error('Êâ´ÊèèËøáÁ®ãÂá∫Èîô:', error);
                    statusText.textContent = `Êâ´ÊèèÂá∫Èîô: ${error.message}`;
                    throw error;
                } finally {
                    isScanning = false;
                    currentScanDir = '';
                    webapp.toast('Êâ´ÊèèÂÆåÊàê');
                }
            }
            async function scanDirectory(dirPath, appName) {
                if (!isScanning || cancelRequested) return;
                try {
                    console.log(`=== ÂºÄÂßãÊâ´ÊèèÁõÆÂΩ? ${dirPath} ===`);
                    dirPath = normalizePath(dirPath);
                    console.log(`ËßÑËåÉÂåñÂêéÁöÑÁõÆÂΩïË∑ØÂæ? ${dirPath}`);
                    const files = webapp.listfile(dirPath);
                    console.log('ÁõÆÂΩïÂÜÖÂÆπÂéüÂßãËøîÂõû:', files);
                    if (!files || files === "null") {
                        console.log(`ÁõÆÂΩï‰∏∫Á©∫Êàñ‰∏çÂ≠òÂú®: ${dirPath}`);
                        return;
                    }
                    const fileList = files.split(/[\\/]/)
                        .map(file => file.trim())
                        .filter(file => file && file !== '.' && file !== '..')
                        .map(file => file.split(/[\\/]/).pop());
                    console.log(`Â§ÑÁêÜÂêéÁöÑÊñá‰ª∂ÂàóË°®:`, fileList);
                    for (let i = 0; i < fileList.length; i++) {
                        if (!isScanning || cancelRequested) break;
                        const fileName = fileList[i];
                        const filePath = `${dirPath}/${fileName}`;
                        totalFilesScanned++;
                        // Êõ¥Êñ∞ËøõÂ∫¶
                        if (totalFilesScanned % 10 === 0) {
                            document.getElementById('scan-progress-bar').style.width =
                                `${Math.min(100, (totalFilesScanned / 1000) * 100)}%`;
                        }
                        try {
                            if (isMusicFile(fileName)) {
                                console.log(`ÂèëÁé∞Èü≥‰πêÊñá‰ª∂: ${fileName}`);
                                const songInfo = await parseMusicFile(filePath);
                                if (songInfo) {
                                    songInfo.source = appName;
                                    localSongs.push(songInfo);
                                    scanStats[appName]++;
                                    // ËäÇÊµÅUIÊõ¥Êñ∞ÔºåÊØè5È¶ñÊõ¥Êñ∞‰∏ÄÊ¨?                                    if (localSongs.length % 5 === 0) {
                                        updateLocalMusicListUI();
                                    }
                                }
                            }
                        } catch (fileError) {
                            console.error(`Â§ÑÁêÜÊñá‰ª∂Â§±Ë¥•: ${fileName}`, fileError);
                            continue;
                        }
                    }
                } catch (error) {
                    console.error('ÁõÆÂΩïÊâ´ÊèèÂ§±Ë¥•:', {
                        directory: dirPath,
                        error: error.message
                    });
                    throw error;
                }
            }

            function isMusicFile(filename) {
                if (!filename || typeof filename !== 'string') return false;
                return supportedFormats.some(format =>
                    filename.toLowerCase().endsWith(format)
                );
            }
            async function parseMusicFile(filepath) {
                return new Promise((resolve) => {
                    try {
                        console.log(`ÂºÄÂßãËß£ÊûêÈü≥‰πêÊñá‰ª? ${filepath}`);
                        const file = {
                            path: filepath,
                            filename: filepath.split('/').pop() // Ëé∑Âèñ"ÂçóÂæÅÂåóÊàòNZBZ-ÊàëÁöÑÂ§©Á©∫.mp3"
                        };
                        new window.jsmediatags.Reader(file.path)
                            .read({
                                onSuccess: (tag) => {
                                    console.log(`ÊàêÂäüËØªÂèñÈü≥‰πêÊ†áÁ≠æ: ${file.filename}`);
                                    const source = Object.entries(musicAppPaths)
                                        .find(([_, path]) => filepath.includes(path))[0] || 'Êú™Áü•Êù•Ê∫ê';
                                    // ÂàùÂßãÂåñÊ†áÈ¢òÂíåËâ∫ÊúØÂÆ?                                    let title = tag.tags.title;
                                    let artist = tag.tags.artist;
                                    // Â¶ÇÊûúÂÖÉÊï∞ÊçÆ‰∏≠Áº∫Â∞ëËâ∫ÊúØÂÆ∂ÊàñÊ†áÈ¢òÔºåÂ∞ùËØï‰ªéÊñá‰ª∂ÂêçËß£Êû?                                    if (!title || !artist) {
                                        const filenameWithoutExt = file.filename.replace(/\.[^/.]+$/, '');
                                        // ‰∏≠ÊñáÈü≥‰πêÂ∏∏ËßÅÂàÜÈöîÁ¨? "-", "Ôº?, "‚Ä?
                                        const separators = [' - ', '-', 'Ôº?, '‚Ä?];
                                        let foundSeparator = null;
                                        let parts = [];
                                        // Â∞ùËØïÊâæÂà∞Á¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÂàÜÈöîÁ¨?                                        for (const sep of separators) {
                                            if (filenameWithoutExt.includes(sep)) {
                                                parts = filenameWithoutExt.split(sep);
                                                foundSeparator = sep;
                                                break;
                                            }
                                        }
                                        // Â§ÑÁêÜÊãÜÂàÜÁªìÊûú
                                        if (parts.length >= 2) {
                                            // ÈÄöÂ∏∏Á¨¨‰∏ÄÈÉ®ÂàÜÊòØËâ∫ÊúØÂÆ∂ÔºåÂÖ∂‰ΩôÈÉ®ÂàÜÊòØÊ†áÈ¢òÔºàÂ§ÑÁêÜÊ†áÈ¢ò‰∏≠ÂèØËÉΩÂåÖÂê´ÂàÜÈöîÁ¨¶ÁöÑÊÉÖÂÜµÔº?                                            artist = artist || parts[0].trim();
                                            title = title || parts.slice(1).join(foundSeparator).trim();
                                        } else {
                                            // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂàÜÈöîÁ¨¶ÔºåÊï¥‰∏™Êñá‰ª∂Âêç‰Ωú‰∏∫Ê†áÈ¢?                                            title = title || filenameWithoutExt;
                                            artist = artist || 'Êú™Áü•Ëâ∫ÊúØÂÆ?;
                                        }
                                    }
                                    // ÊúÄÁªàÊ∏ÖÁêÜÂíåÊ†ºÂºèÂå?                                    title = title ? fixEncoding(title.trim()) : 'Êú™Áü•Ê†áÈ¢ò';
                                    artist = artist ? fixEncoding(artist.trim()) : 'Êú™Áü•Ëâ∫ÊúØÂÆ?;
                                    const songInfo = {
                                        path: file.path,
                                        title: title,
                                        artist: artist,
                                        album: fixEncoding(tag.tags.album || 'Êú™Áü•‰∏ìËæë'),
                                        image: tag.tags.picture ? getImageUrl(tag.tags.picture) : 'favicon.png',
                                        type: 'local',
                                        source: source,
                                        duration: tag.tags.duration || 0
                                    };
                                    console.log(`Ëß£ÊûêÁªìÊûú:`, songInfo);
                                    resolve(songInfo);
                                },
                                onError: (error) => {
                                    console.warn(`Êó†Ê≥ïËØªÂèñÈü≥‰πêÊ†áÁ≠æ: ${file.filename}`, error);
                                    manualParseMusicFile(filepath).then(resolve);
                                }
                            });
                    } catch (error) {
                        console.error(`Ëß£ÊûêÈü≥‰πêÊñá‰ª∂Â§±Ë¥•: ${filepath}`, error);
                        manualParseMusicFile(filepath).then(resolve);
                    }
                });
            }
            async function manualParseMusicFile(filePath) {
                try {
                    const fileSize = webapp.gainsize(filePath);
                    if (fileSize <= 0) return null;
                    const fileData = webapp.gainfile(filePath, 0, 256 * 1024);
                    if (!fileData) return null;
                    let bytes;
                    if (fileData.startsWith('data:')) {
                        const binaryString = atob(fileData.split(',')[1]);
                        bytes = new Uint8Array(binaryString.length);
                        for (let i = 0; i < binaryString.length; i++) {
                            bytes[i] = binaryString.charCodeAt(i);
                        }
                    } else {
                        bytes = new Uint8Array(fileData);
                    }
                    const tags = parseAudioTags(bytes, filePath);
                    const source = Object.entries(musicAppPaths)
                        .find(([_, path]) => filePath.includes(path))[0] || 'Êú™Áü•Êù•Ê∫ê';
                    // Ëé∑ÂèñÊñá‰ª∂ÂêçÔºà‰∏çÂê´Ë∑ØÂæÑÔº?                    const filename = filePath.split('/').pop();
                    // ÂàùÂßãÂåñÊ†áÈ¢òÂíåËâ∫ÊúØÂÆ?                    let title = tags.title;
                    let artist = tags.artist;
                    // Â¶ÇÊûúÂÖÉÊï∞ÊçÆ‰∏≠Áº∫Â∞ëËâ∫ÊúØÂÆ∂ÊàñÊ†áÈ¢òÔºåÂ∞ùËØï‰ªéÊñá‰ª∂ÂêçËß£Êû?                    if (!title || !artist) {
                        const filenameWithoutExt = filename.replace(/\.[^/.]+$/, ''); // ÁßªÈô§Êâ©Â±ïÂê?                        // ‰∏≠ÊñáÈü≥‰πêÂ∏∏ËßÅÂàÜÈöîÁ¨?                        const separators = [' - ', '-', 'Ôº?, '‚Ä?];
                        let foundSeparator = null;
                        let parts = [];
                        // Â∞ùËØïÊâæÂà∞Á¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÂàÜÈöîÁ¨?                        for (const sep of separators) {
                            if (filenameWithoutExt.includes(sep)) {
                                parts = filenameWithoutExt.split(sep);
                                foundSeparator = sep;
                                break;
                            }
                        }
                        // Â§ÑÁêÜÊãÜÂàÜÁªìÊûú
                        if (parts.length >= 2) {
                            // ÈÄöÂ∏∏Á¨¨‰∏ÄÈÉ®ÂàÜÊòØËâ∫ÊúØÂÆ∂ÔºåÂÖ∂‰ΩôÈÉ®ÂàÜÊòØÊ†áÈ¢ò
                            artist = artist || parts[0].trim();
                            title = title || parts.slice(1).join(foundSeparator).trim();
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÂàÜÈöîÁ¨¶ÔºåÊï¥‰∏™Êñá‰ª∂Âêç‰Ωú‰∏∫Ê†áÈ¢?                            title = title || filenameWithoutExt;
                            artist = artist || 'Êú™Áü•Ëâ∫ÊúØÂÆ?;
                        }
                    }
                    // ÊúÄÁªàÊ∏ÖÁêÜÂíåÊ†ºÂºèÂå?                    title = title ? fixEncoding(title.trim()) : 'Êú™Áü•Ê†áÈ¢ò';
                    artist = artist ? fixEncoding(artist.trim()) : 'Êú™Áü•Ëâ∫ÊúØÂÆ?;
                    return {
                        path: filePath,
                        title: title,
                        artist: artist,
                        album: fixEncoding(tags.album || 'Êú™Áü•‰∏ìËæë'),
                        image: tags.albumArt || 'favicon.png',
                        type: 'local',
                        source: source,
                        size: fileSize,
                        duration: tags.duration || 0
                    };
                } catch (error) {
                    console.error('ÊâãÂä®Ëß£ÊûêÂ§±Ë¥•:', error);
                    // Âç≥‰ΩøÂú®ÈîôËØØÊÉÖÂÜµ‰∏ã‰πüÂ∞ùËØï‰ªéÊñá‰ª∂ÂêçËß£ÊûêÂü∫Êú¨‰ø°ÊÅ?                    const filename = filePath.split('/').pop();
                    const filenameWithoutExt = filename.replace(/\.[^/.]+$/, '');
                    // Â∞ùËØï‰ªéÊñá‰ª∂ÂêçÂàÜÁ¶ªËâ∫ÊúØÂÆ∂ÂíåÊ†áÈ¢ò
                    const separators = [' - ', '-', 'Ôº?, '‚Ä?];
                    let parts = [filenameWithoutExt];
                    for (const sep of separators) {
                        if (filenameWithoutExt.includes(sep)) {
                            parts = filenameWithoutExt.split(sep);
                            break;
                        }
                    }
                    const title = parts.length >= 2 ? parts.slice(1).join(' ').trim() : filenameWithoutExt;
                    const artist = parts.length >= 2 ? parts[0].trim() : 'Êú™Áü•Ëâ∫ÊúØÂÆ?;
                    return {
                        path: filePath,
                        title: fixEncoding(title),
                        artist: fixEncoding(artist),
                        album: 'Êú™Áü•‰∏ìËæë',
                        image: 'favicon.png',
                        type: 'local',
                        source: 'Êú™Áü•Êù•Ê∫ê',
                        size: 0,
                        duration: 0
                    };
                }
            }

            function parseAudioTags(bytes, filePath) {
                const tags = {};
                const ext = filePath.toLowerCase().slice(-4);
                // Â∞ùËØïËß£ÊûêID3Ê†áÁ≠æ (MP3)
                if (bytes[0] === 0x49 && bytes[1] === 0x44 && bytes[2] === 0x33) {
                    parseID3Tags(bytes, tags);
                }
                // Â∞ùËØïËß£ÊûêMP4/3GPÊ†áÁ≠æ
                else if (['.m4a', '.mp4', '.3gp'].includes(ext)) {
                    parseMP4Tags(bytes, tags);
                }
                // Â∞ùËØïËß£ÊûêFLACÊ†áÁ≠æ
                else if (bytes[0] === 0x66 && bytes[1] === 0x4C && bytes[2] === 0x61 && bytes[3] === 0x43) {
                    parseFLACTags(bytes, tags);
                }
                // Â∞ùËØïËß£ÊûêOggÊ†áÁ≠æ
                else if (bytes[0] === 0x4F && bytes[1] === 0x67 && bytes[2] === 0x67 && bytes[3] === 0x53) {
                    parseOggTags(bytes, tags);
                }
                return tags;
            }

            function parseID3Tags(bytes, tags) {
                // ÁÆÄÂåñÁöÑID3Ê†áÁ≠æËß£Êûê
                try {
                    // Êü•ÊâæÊ†áÈ¢ò (TIT2Â∏?
                    const tit2Index = findID3Frame(bytes, 'TIT2');
                    if (tit2Index !== -1) {
                        tags.title = parseID3TextFrame(bytes, tit2Index);
                    }
                    // Êü•ÊâæËâ∫ÊúØÂÆ?(TPE1Â∏?
                    const tpe1Index = findID3Frame(bytes, 'TPE1');
                    if (tpe1Index !== -1) {
                        tags.artist = parseID3TextFrame(bytes, tpe1Index);
                    }
                    // Êü•Êâæ‰∏ìËæë (TALBÂ∏?
                    const talbIndex = findID3Frame(bytes, 'TALB');
                    if (talbIndex !== -1) {
                        tags.album = parseID3TextFrame(bytes, talbIndex);
                    }
                } catch (e) {
                    console.warn('ID3Ê†áÁ≠æËß£ÊûêÂ§±Ë¥•:', e);
                }
            }

            function findID3Frame(bytes, frameId) {
                // ÁÆÄÂåñÁöÑID3Â∏ßÊü•Êâ?                for (let i = 10; i < bytes.length - 4; i++) {
                    if (String.fromCharCode(bytes[i], bytes[i + 1], bytes[i + 2], bytes[i + 3]) === frameId) {
                        return i;
                    }
                }
                return -1;
            }

            function parseID3TextFrame(bytes, offset) {
                const encoding = bytes[offset + 4];
                let text = '';
                // Ë∑≥ËøáÂ∏ßÂ§¥ÂíåÁºñÁ†ÅÂ≠óËä?                let i = offset + 5;
                // UTF-16 with BOM
                if (encoding === 1) {
                    const bom = (bytes[i] << 8) | bytes[i + 1];
                    i += 2; // Ë∑≥ËøáBOM
                    // Êü•ÊâæÂèåÁ©∫ÁªàÊ≠¢Á¨?                    while (i < bytes.length - 1 && !(bytes[i] === 0 && bytes[i + 1] === 0)) {
                        text += String.fromCharCode((bytes[i] << 8) | bytes[i + 1]);
                        i += 2;
                    }
                }
                // UTF-16 without BOM or UTF-8
                else {
                    // Êü•ÊâæÁ©∫ÁªàÊ≠¢Á¨¶
                    while (i < bytes.length && bytes[i] !== 0) {
                        text += String.fromCharCode(bytes[i]);
                        i++;
                    }
                }
                return text;
            }

            function parseMP4Tags(bytes, tags) {
                // ÁÆÄÂåñÁöÑMP4Ê†áÁ≠æËß£Êûê
                try {
                    // Êü•Êâæmoov -> udta -> meta -> ilstÂéüÂ≠ê
                    let i = 0;
                    while (i < bytes.length - 8) {
                        const size = (bytes[i] << 24) | (bytes[i + 1] << 16) | (bytes[i + 2] << 8) | bytes[i + 3];
                        const type = String.fromCharCode(bytes[i + 4], bytes[i + 5], bytes[i + 6], bytes[i + 7]);
                        if (type === 'moov') {
                            let j = i + 8;
                            while (j < i + size) {
                                const subSize = (bytes[j] << 24) | (bytes[j + 1] << 16) | (bytes[j + 2] << 8) | bytes[j + 3];
                                const subType = String.fromCharCode(bytes[j + 4], bytes[j + 5], bytes[j + 6], bytes[j + 7]);
                                if (subType === 'udta') {
                                    let k = j + 8;
                                    while (k < j + subSize) {
                                        const subSubSize = (bytes[k] << 24) | (bytes[k + 1] << 16) | (bytes[k + 2] << 8) | bytes[k + 3];
                                        const subSubType = String.fromCharCode(bytes[k + 4], bytes[k + 5], bytes[k + 6], bytes[k + 7]);
                                        if (subSubType === 'meta') {
                                            // Ë∑≥ËøámetaÂ§?                                            let l = k + 12; // Ë∑≥ËøáÂ§ßÂ∞èÂíåÁ±ªÂûã‰ª•Âè?Â≠óËäÇÁöÑÁâàÊú?flags
                                            while (l < k + subSubSize) {
                                                const ilstSize = (bytes[l] << 24) | (bytes[l + 1] << 16) | (bytes[l + 2] << 8) | bytes[l + 3];
                                                const ilstType = String.fromCharCode(bytes[l + 4], bytes[l + 5], bytes[l + 6], bytes[l + 7]);
                                                if (ilstType === '¬©nam') {
                                                    tags.title = parseMP4TextValue(bytes, l + 8, ilstSize - 8);
                                                } else if (ilstType === '¬©ART') {
                                                    tags.artist = parseMP4TextValue(bytes, l + 8, ilstSize - 8);
                                                } else if (ilstType === '¬©alb') {
                                                    tags.album = parseMP4TextValue(bytes, l + 8, ilstSize - 8);
                                                }
                                                l += ilstSize;
                                            }
                                        }
                                        k += subSize;
                                    }
                                }
                                j += subSize;
                            }
                        }
                        i += size;
                    }
                } catch (e) {
                    console.warn('MP4Ê†áÁ≠æËß£ÊûêÂ§±Ë¥•:', e);
                }
            }

            function parseMP4TextValue(bytes, offset, size) {
                // Ë∑≥ËøáÂèØËÉΩÁöÑnullÂ≠óËäÇÂíåÊï∞ÊçÆÁ±ªÂûãÊåáÁ§?                let i = offset + 8;
                let text = '';
                while (i < offset + size && bytes[i] !== 0) {
                    text += String.fromCharCode(bytes[i]);
                    i++;
                }
                return text;
            }

            function parseFLACTags(bytes, tags) {
                // ÁÆÄÂåñÁöÑFLACÊ†áÁ≠æËß£Êûê
                try {
                    // FLACÊ†áÁ≠æ‰Ωç‰∫éÊñá‰ª∂ÂºÄÂßãÂêéÁö?Â≠óËäÇ"fLaC"Á≠æÂêç‰πãÂêé
                    let i = 4;
                    // Êü•ÊâæMETADATA_BLOCK_VORBIS_COMMENT (Á±ªÂûã4)
                    while (i < bytes.length - 4) {
                        const isLast = (bytes[i] & 0x80) !== 0;
                        const type = bytes[i] & 0x7F;
                        const length = (bytes[i + 1] << 16) | (bytes[i + 2] << 8) | bytes[i + 3];
                        if (type === 4) {
                            // Ë∑≥ËøáÂùóÂ§¥ÂíåÈïøÂ∫?                            i += 4;
                            // ËØªÂèñvendorÂ≠óÁ¨¶‰∏≤ÈïøÂ∫?(Â∞èÁ´Ø)
                            const vendorLength = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                            i += 4 + vendorLength;
                            // ËØªÂèñËØÑËÆ∫Êï?                            const commentCount = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                            i += 4;
                            // Ëß£ÊûêÊØè‰∏™ËØÑËÆ∫
                            for (let c = 0; c < commentCount && i < bytes.length; c++) {
                                const commentLength = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                                i += 4;
                                let comment = '';
                                for (let j = 0; j < commentLength && i + j < bytes.length; j++) {
                                    comment += String.fromCharCode(bytes[i + j]);
                                }
                                i += commentLength;
                                // Ëß£ÊûêÈîÆÂÄºÂØπ
                                const eqPos = comment.indexOf('=');
                                if (eqPos > 0) {
                                    const key = comment.substring(0, eqPos).toUpperCase();
                                    const value = comment.substring(eqPos + 1);
                                    if (key === 'TITLE') tags.title = value;
                                    else if (key === 'ARTIST') tags.artist = value;
                                    else if (key === 'ALBUM') tags.album = value;
                                }
                            }
                            break;
                        }
                        i += 4 + length;
                        if (isLast) break;
                    }
                } catch (e) {
                    console.warn('FLACÊ†áÁ≠æËß£ÊûêÂ§±Ë¥•:', e);
                }
            }

            function parseOggTags(bytes, tags) {
                // ÁÆÄÂåñÁöÑOgg VorbisÊ†áÁ≠æËß£Êûê
                try {
                    // OggSÁ≠æÂêçÂêéÁöÑÈ°µÈù¢
                    let i = 28; // Ë∑≥ËøáOggSÂ§¥ÂíåÈ°µÈù¢Â∫èÂàó
                    // Êü•ÊâævorbisÊ≥®ÈáäÂ§?                    while (i < bytes.length - 8) {
                        if (String.fromCharCode(bytes[i], bytes[i + 1], bytes[i + 2], bytes[i + 3], bytes[i + 4], bytes[i + 5]) === 'vorbis') {
                            i += 7; // Ë∑≥Ëøá"vorbis"ÂíåÂåÖÁ±ªÂûã
                            // ËØªÂèñvendorÂ≠óÁ¨¶‰∏≤ÈïøÂ∫?                            const vendorLength = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                            i += 4 + vendorLength;
                            // ËØªÂèñËØÑËÆ∫Êï?                            const commentCount = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                            i += 4;
                            // Ëß£ÊûêÊØè‰∏™ËØÑËÆ∫
                            for (let c = 0; c < commentCount && i < bytes.length; c++) {
                                const commentLength = (bytes[i] | (bytes[i + 1] << 8) | (bytes[i + 2] << 16) | (bytes[i + 3] << 24));
                                i += 4;
                                let comment = '';
                                for (let j = 0; j < commentLength && i + j < bytes.length; j++) {
                                    comment += String.fromCharCode(bytes[i + j]);
                                }
                                i += commentLength;
                                // Ëß£ÊûêÈîÆÂÄºÂØπ
                                const eqPos = comment.indexOf('=');
                                if (eqPos > 0) {
                                    const key = comment.substring(0, eqPos).toUpperCase();
                                    const value = comment.substring(eqPos + 1);
                                    if (key === 'TITLE') tags.title = value;
                                    else if (key === 'ARTIST') tags.artist = value;
                                    else if (key === 'ALBUM') tags.album = value;
                                }
                            }
                            break;
                        }
                        i++;
                    }
                } catch (e) {
                    console.warn('OggÊ†áÁ≠æËß£ÊûêÂ§±Ë¥•:', e);
                }
            }

            function getImageUrl(picture) {
                if (!picture) return 'favicon.png';
                const {
                    data,
                    format
                } = picture;
                let base64String = '';
                for (let i = 0; i < data.length; i++) {
                    base64String += String.fromCharCode(data[i]);
                }
                return `data:${format};base64,${window.btoa(base64String)}`;
            }

            function fixEncoding(text) {
                if (!text) return text;
                try {
                    if (/[\u4e00-\u9fa5]/.test(text)) {
                        return text;
                    }
                    const utf8Text = decodeURIComponent(escape(text));
                    return utf8Text && utf8Text !== text ? utf8Text : text;
                } catch (e) {
                    return text;
                }
            }

            function getFileName(filePath) {
                const fileName = filePath.split('/').pop().replace(/\.[^/.]+$/, '');
                return fileName.replace(/[_-]/g, ' ').trim();
            }

            function normalizePath(path) {
                return path.replace(/[\\/]+/g, '/').replace(/\/$/, '');
            }

            function updateLocalMusicListUI() {
                const localSongList = document.getElementById('local-song-list');
                if (localSongs.length === 0) {
                    localSongList.innerHTML = '<div class="empty-state">Ê≤°ÊúâÊâæÂà∞Êú¨Âú∞Èü≥‰πê</div>';
                    return;
                }
                // ‰ΩøÁî®ÊñáÊ°£ÁâáÊÆµÊèêÈ´òÊÄßËÉΩ
                const fragment = document.createDocumentFragment();
                localSongs.forEach((song, index) => {
                    const songElement = document.createElement('div');
                    songElement.className = 'song-item';
                    songElement.innerHTML = `
            <div class="song-number">${index + 1}</div>
            <div class="song-info">
                <div class="song-title">${song.title}</div>
                <div class="song-artist">${song.artist}</div>
            </div>
            <div class="song-quality">Êú¨Âú∞ - ${song.source || 'Êú™Áü•Êù•Ê∫ê'}</div>
        `;
                    songElement.addEventListener('click', function () {
                        // Êõ¥Êñ∞ÂΩìÂâçÈÄâ‰∏≠Ê≠åÊõ≤
                        document.querySelectorAll('.song-item').forEach(el => {
                            el.classList.remove('active');
                        });
                        this.classList.add('active');
                        currentSong = song;
                        currentSongIndex = index;
                        playSong(song);
                        // Êõ¥Êñ∞miniÊí≠ÊîæÂô®ÂèØËßÅÊÄ?                        updateMiniPlayerVisibility();
                    });
                    fragment.appendChild(songElement);
                });
                localSongList.innerHTML = '';
                localSongList.appendChild(fragment);
            }

            function saveLocalSongs() {
                console.group('‰øùÂ≠òÊú¨Âú∞Èü≥‰πêÂàóË°®');
                try {
                    const serializedData = JSON.stringify(localSongs);
                    console.log(`Ê≠£Âú®‰øùÂ≠ò ${localSongs.length} È¶ñÊ≠åÊõ≤Êï∞ÊçÆ`);
                    localStorage.setItem('localSongs', serializedData);
                    console.log('‚ú?‰øùÂ≠òÊàêÂäü');
                } catch (error) {
                    console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
                } finally {
                    console.groupEnd();
                }
            }

            function loadLocalSongs() {
                console.group('Âä†ËΩΩÊú¨Âú∞Èü≥‰πêÂàóË°®');
                try {
                    const saved = localStorage.getItem('localSongs');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        if (Array.isArray(parsed)) {
                            localSongs = parsed.filter(song => checkLocalFileExists(song.path));
                            console.log(`ÊàêÂäüÂä†ËΩΩ ${localSongs.length} È¶ñÊ≠åÊõ≤`);
                        } else {
                            throw new Error('Êó†ÊïàÁöÑÊï∞ÊçÆÊ†ºÂº?);
                        }
                    } else {
                        localSongs = [];
                    }
                    updateLocalMusicListUI();
                } catch (error) {
                    console.error('Âä†ËΩΩÂ§±Ë¥•:', error);
                    localSongs = [];
                    localStorage.removeItem('localSongs');
                } finally {
                    console.groupEnd();
                }
            }

            function checkLocalFileExists(filePath) {
                try {
                    return webapp.gainsize(filePath) > 0;
                } catch (e) {
                    return false;
                }
            }

            function handleLocalSearch(e) {
                const keyword = e.target.value.toLowerCase().trim();
                if (!keyword) {
                    updateLocalMusicListUI();
                    return;
                }
                const filtered = localSongs.filter(song =>
                    song.title.toLowerCase().includes(keyword) ||
                    song.artist.toLowerCase().includes(keyword) ||
                    song.album.toLowerCase().includes(keyword)
                );
                displayFilteredLocalSongs(filtered);
            }

            function displayFilteredLocalSongs(filtered) {
                const localSongList = document.getElementById('local-song-list');
                if (filtered.length === 0) {
                    localSongList.innerHTML = '<div class="empty-state">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊ≠åÊõ?/div>';
                    return;
                }
                const fragment = document.createDocumentFragment();
                filtered.forEach((song, index) => {
                    const songElement = document.createElement('div');
                    songElement.className = 'song-item';
                    songElement.innerHTML = `
            <div class="song-number">${index + 1}</div>
            
            <div class="song-info">
                <div class="song-title">${song.title}</div>
                <div class="song-artist">${song.artist}</div>
            </div>
            <div class="song-quality">Êú¨Âú∞ - ${song.source || 'Êú™Áü•Êù•Ê∫ê'}</div>
        `;
                    songElement.addEventListener('click', () => {
                        playSong(song, index);
                    });
                    fragment.appendChild(songElement);
                });
                localSongList.innerHTML = '';
                localSongList.appendChild(fragment);
            }

            function debounce(func, wait) {
                let timeout;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        func.apply(context, args);
                    }, wait);
                };
            }
            // ÂàùÂßãÂåñÊú¨Âú∞Èü≥‰πêÂäüËÉ?            initLocalMusic();
            document.onselectstart = function () {
                return false;
            };
            const chartNav = document.querySelector('.chart-nav');
            if (chartNav) {
                chartNav.addEventListener('click', async (e) => {
                    const btn = e.target.closest('.chart-nav-btn');
                    if (btn) {
                        // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄ?                        const buttons = chartNav.querySelectorAll('.chart-nav-btn');
                        buttons.forEach(button => button.classList.remove('active'));
                        btn.classList.add('active');
                        // Ëé∑ÂèñÂπ∂Âä†ËΩΩÂØπÂ∫îÊ¶úÂçïÊï∞Êç?                        const chartId = btn.dataset.id;
                        // Ê∏ÖÁ©∫ÂΩìÂâçÂàóË°®
                        document.getElementById('hot-search-list').innerHTML = '';
                        try {
                            // Ëé∑ÂèñÊñ∞ÁöÑÊ¶úÂçïÊï∞ÊçÆ
                            const data = await getHotSearchData(chartId);
                            if (data && data.length > 0) {
                                // ‰º†ÂÖ•Ê≠£Á°ÆÁö?chartId ÊòæÁ§∫Ê¶úÂçïÊï∞ÊçÆ
                                await displayHotSearchItems(data.slice(0, 30), chartId);
                            } else {
                                document.getElementById('hot-search-list').innerHTML =
                                    '<div class="empty-state">ÊöÇÊó†Êï∞ÊçÆ</div>';
                            }
                        } catch (error) {
                            console.error('Âä†ËΩΩÊ¶úÂçïÂ§±Ë¥•:', error);
                            document.getElementById('hot-search-list').innerHTML =
                                '<div class="empty-state">Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØï</div>';
                            webapp.toast('Âä†ËΩΩÂ§±Ë¥•');
                        }
                    }
                });
            }
            //ÂπøÂëä
            // ÂàáÊç¢Âà∞ÂπøÂëäÊ®°ÂºèÁöÑÂáΩÊï∞
            function switchToAdMode() {
                const playerTab = document.getElementById('player-tab');
                playerTab.classList.remove('playing-mode');
                playerTab.classList.add('ad-mode');
                // ÊòæÁ§∫ÂΩìÂâçÂπøÂëä
                const tabBgImage = document.getElementById('tab-bg-image');
                currentAdIndex = (currentAdIndex + 1) % adImages.length;
                tabBgImage.style.backgroundImage = adImages[currentAdIndex];
                // Êõ¥Êñ∞ÊñáÊú¨‰∏∫ÂπøÂëäÂÜÖÂÆ?                tabTitle.textContent = "ËµûÂä©ÂïÜÂπøÂë?;
                tabArtist.textContent = "ÁÇπÂáªÊí≠ÊîæÊåâÈíÆÊÅ¢Â§çÊí≠Êîæ";
                // ÊöÇÂÅúÈü≥È¢ëÔºà‰ΩÜ‰∏çÈáçÁΩÆËøõÂ∫¶Ôºâ
                audioPlayer.pause();
            }
            // ÂàáÊç¢Âà∞Êí≠ÊîæÊ®°ÂºèÁöÑÂáΩÊï∞
            function switchToPlayingMode() {
                const playerTab = document.getElementById('player-tab');
                playerTab.classList.remove('ad-mode');
                playerTab.classList.add('playing-mode');
                // ËÆæÁΩÆÈü≥‰πêËÉåÊôØ
                const tabBgImage = document.getElementById('tab-bg-image');
                tabBgImage.style.backgroundImage = musicBg;
                // ÊÅ¢Â§çÊ≠åÊõ≤‰ø°ÊÅØÊòæÁ§∫
                if (currentSong) {
                    tabTitle.textContent = currentSong.title;
                    tabArtist.textContent = currentSong.artist;
                }
            }
            // Ê∑ªÂä†ÂπøÂëäËΩÆÊí≠ÂáΩÊï∞
            function startAdRotation() {
                // ÂÖàÊ∏ÖÈô§Â∑≤ÊúâÁöÑinterval
                clearInterval(adInterval);
                // ÊØ?ÁßíÂàáÊç¢ÂπøÂë?                adInterval = setInterval(() => {
                    if (!isPlaying) {
                        currentAdIndex = (currentAdIndex + 1) % adImages.length;
                        const tabBgImage = document.getElementById('tab-bg-image');
                        tabBgImage.style.backgroundImage = adImages[currentAdIndex];
                    }
                }, 10000);
            }
        });
        document.getElementById('clear-local-cache').addEventListener('click', function () {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÁºìÂ≠òÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔº?)) {
                // Ê∏ÖÈô§localStorage
                localStorage.clear();
                // Ê∏ÖÈô§sessionStorage
                sessionStorage.clear();
                // Â¶ÇÊûúÊúâIndexedDBÊï∞ÊçÆÂ∫ìÔºå‰πüÂèØ‰ª•Ê∏ÖÈô?                // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆ‰Ω†ÁöÑÂÆûÈôÖÊï∞ÊçÆÂ∫ìÂêçÁß∞Êù•Ê∏ÖÈô?                // ÊòæÁ§∫Ê∏ÖÈô§ÊàêÂäüÁöÑÊèêÁ§?                webapp.toast('ÁºìÂ≠òÂ∑≤ÊàêÂäüÊ∏ÖÈô§ÔºÅ');
                // ÊàñËÄÖ‰ΩøÁî®Êõ¥ÁæéËßÇÁöÑÈÄöÁü•ÊñπÂºèÔºå‰æãÂ¶ÇÔºö
                // showNotification('ÁºìÂ≠òÂ∑≤Ê∏ÖÈô?, 'success');
                // Â¶ÇÊûúÈúÄË¶ÅÂà∑Êñ∞È°µÈù?                // window.location.reload();
            }
        });
    </script>
    <script src="notify.js"></script>
    <script src="aboutUpdate5.1.js"></script>
</body>

</html>

